<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ­è§†é¢‘å†…å®¹ç”Ÿäº§ç³»ç»Ÿ v3.2 - å¤šæ¨¡å‹AIç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==================== æŒä¹…åŒ–å­˜å‚¨å°è£… ====================
        const usePersistedState = (key, initialValue) => {
            const [value, setValue] = useState(initialValue);
            const [loading, setLoading] = useState(true);

            // åˆå§‹åŒ–ï¼šä»å­˜å‚¨åŠ è½½æ•°æ®
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const result = await window.storage.get(key, false);
                        if (result && result.value) {
                            setValue(JSON.parse(result.value));
                        }
                    } catch (error) {
                        console.log('åŠ è½½æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åˆå§‹å€¼:', error);
                    } finally {
                        setLoading(false);
                    }
                };
                loadData();
            }, [key]);

            // ä¿å­˜ï¼šå½“å€¼å˜åŒ–æ—¶ä¿å­˜åˆ°å­˜å‚¨
            useEffect(() => {
                if (!loading) {
                    const saveData = async () => {
                        try {
                            await window.storage.set(key, JSON.stringify(value), false);
                        } catch (error) {
                            console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                        }
                    };
                    saveData();
                }
            }, [key, value, loading]);

            return [value, setValue, loading];
        };

        // ==================== è§†é¢‘å¸§æå– ====================
        const extractVideoFrame = (videoFile) => {
            return new Promise((resolve, reject) => {
                const video = document.createElement('video');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                video.preload = 'metadata';
                video.src = URL.createObjectURL(videoFile);
                video.onloadeddata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    video.currentTime = 0.1;
                };
                video.onseeked = () => {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const thumbnail = canvas.toDataURL('image/jpeg', 0.7);
                    URL.revokeObjectURL(video.src);
                    resolve(thumbnail);
                };
                video.onerror = () => {
                    URL.revokeObjectURL(video.src);
                    reject(new Error('è§†é¢‘åŠ è½½å¤±è´¥'));
                };
            });
        };

        // ==================== å›¾ç‰‡è½¬base64 ====================
        const imageToBase64 = (imageFile) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(imageFile);
            });
        };

        // ==================== AI åˆ†æå›¾ç‰‡ - æ”¯æŒå¤šæ¨¡å‹ ====================
        const analyzeImageWithAI = async (base64Image) => {
            const provider = window.CURRENT_AI_PROVIDER;
            if (!provider) {
                throw new Error('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®å¹¶é€‰æ‹© AI æ¨¡å‹');
            }

            if (!provider.vision.enabled) {
                throw new Error('å½“å‰æ¨¡å‹æœªå¯ç”¨è§†è§‰åŠŸèƒ½ï¼Œè¯·é…ç½®æˆ–åˆ‡æ¢å…¶ä»–æ¨¡å‹');
            }

            if (!provider.vision.apiKey) {
                throw new Error('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®è§†è§‰æ¨¡å‹çš„ API å¯†é’¥');
            }

            const config = provider.vision;

            try {
                let requestConfig;

                // æ ¹æ®ä¸åŒçš„æ¨¡å‹ç±»å‹æ„å»ºè¯·æ±‚
                if (provider.type === 'doubao') {
                    requestConfig = {
                        url: config.apiEndpoint,
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${config.apiKey}`
                        },
                        body: {
                            model: config.model,
                            messages: [{
                                role: "user",
                                content: [
                                    {
                                        type: "image_url",
                                        image_url: { url: `data:image/jpeg;base64,${base64Image}` }
                                    },
                                    {
                                        type: "text",
                                        text: `åˆ†æè¿™ä¸ªç´ æï¼Œè¿”å›JSONæ ¼å¼ï¼š{"scene":"åœºæ™¯æè¿°(20-30å­—)","tags":["æ ‡ç­¾1","æ ‡ç­¾2","æ ‡ç­¾3","æ ‡ç­¾4","æ ‡ç­¾5"],"usage":"ä½¿ç”¨å»ºè®®(15-25å­—)","mood":"æƒ…ç»ªæ°›å›´","suggestedName":"æ–‡ä»¶å"}ã€‚æ ‡ç­¾å¿…é¡»åŒ…å«åœºæ™¯ã€å†…å®¹ã€ç”¨é€”æ ‡ç­¾ã€‚åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`
                                    }
                                ]
                            }]
                        }
                    };
                } else if (provider.type === 'claude') {
                    requestConfig = {
                        url: config.apiEndpoint,
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": config.apiKey,
                            "anthropic-version": "2023-06-01"
                        },
                        body: {
                            model: config.model,
                            max_tokens: 1000,
                            messages: [{
                                role: "user",
                                content: [
                                    {
                                        type: "image",
                                        source: {
                                            type: "base64",
                                            media_type: "image/jpeg",
                                            data: base64Image
                                        }
                                    },
                                    {
                                        type: "text",
                                        text: `åˆ†æè¿™ä¸ªç´ æï¼Œè¿”å›JSONæ ¼å¼ï¼š{"scene":"åœºæ™¯æè¿°(20-30å­—)","tags":["æ ‡ç­¾1","æ ‡ç­¾2","æ ‡ç­¾3","æ ‡ç­¾4","æ ‡ç­¾5"],"usage":"ä½¿ç”¨å»ºè®®(15-25å­—)","mood":"æƒ…ç»ªæ°›å›´","suggestedName":"æ–‡ä»¶å"}ã€‚æ ‡ç­¾å¿…é¡»åŒ…å«åœºæ™¯ã€å†…å®¹ã€ç”¨é€”æ ‡ç­¾ã€‚åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`
                                    }
                                ]
                            }]
                        }
                    };
                } else {
                    // é€šç”¨æ ¼å¼ï¼ˆOpenAI å…¼å®¹ï¼‰
                    requestConfig = {
                        url: config.apiEndpoint,
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${config.apiKey}`
                        },
                        body: {
                            model: config.model,
                            messages: [{
                                role: "user",
                                content: [
                                    {
                                        type: "image_url",
                                        image_url: { url: `data:image/jpeg;base64,${base64Image}` }
                                    },
                                    {
                                        type: "text",
                                        text: `åˆ†æè¿™ä¸ªç´ æï¼Œè¿”å›JSONæ ¼å¼ï¼š{"scene":"åœºæ™¯æè¿°(20-30å­—)","tags":["æ ‡ç­¾1","æ ‡ç­¾2","æ ‡ç­¾3","æ ‡ç­¾4","æ ‡ç­¾5"],"usage":"ä½¿ç”¨å»ºè®®(15-25å­—)","mood":"æƒ…ç»ªæ°›å›´","suggestedName":"æ–‡ä»¶å"}ã€‚æ ‡ç­¾å¿…é¡»åŒ…å«åœºæ™¯ã€å†…å®¹ã€ç”¨é€”æ ‡ç­¾ã€‚åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ã€‚`
                                    }
                                ]
                            }]
                        }
                    };
                }

                const response = await fetch(requestConfig.url, {
                    method: "POST",
                    headers: requestConfig.headers,
                    body: JSON.stringify(requestConfig.body)
                });

                const data = await response.json();
                console.log('AIè¿”å›:', data);

                if (data.error) {
                    throw new Error(data.error.message || 'APIè°ƒç”¨å¤±è´¥');
                }

                // æ ¹æ®ä¸åŒæ¨¡å‹è§£æå“åº”
                let text;
                if (provider.type === 'claude') {
                    text = data.content[0].text;
                } else {
                    text = data.choices[0].message.content;
                }

                text = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                return JSON.parse(text);
            } catch (error) {
                console.error('AIåˆ†æå¤±è´¥:', error);
                throw error;
            }
        };

        // ==================== AI æ£€ç´¢å‡½æ•° - æ”¯æŒå¤šæ¨¡å‹ ====================
        const searchMaterialsWithAI = async (idea, materials) => {
            const provider = window.CURRENT_AI_PROVIDER;
            if (!provider) {
                throw new Error('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®å¹¶é€‰æ‹© AI æ¨¡å‹');
            }

            if (!provider.text.enabled) {
                throw new Error('å½“å‰æ¨¡å‹æœªå¯ç”¨æ–‡æœ¬åŠŸèƒ½ï¼Œè¯·é…ç½®æˆ–åˆ‡æ¢å…¶ä»–æ¨¡å‹');
            }

            if (!provider.text.apiKey) {
                throw new Error('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½®æ–‡æœ¬æ¨¡å‹çš„ API å¯†é’¥');
            }

            const config = provider.text;

            const prompt = `ä½ æ˜¯çŸ­è§†é¢‘å†…å®¹ç”Ÿäº§åŠ©æ‰‹ã€‚ç”¨æˆ·æœ‰ä¸€ä¸ªåˆ›ä½œæƒ³æ³•ï¼Œä½ éœ€è¦å¸®åŠ©ä»–ä»ç´ æåº“ä¸­æ‰¾åˆ°åˆé€‚çš„ç´ æã€‚

ç”¨æˆ·æƒ³æ³•ï¼š${idea}

ç´ æåº“æ•°æ®ï¼ˆåŒ…å«ç´ æIDã€åç§°ã€åœºæ™¯ã€æ ‡ç­¾ã€ä½¿ç”¨æ¬¡æ•°ç­‰ä¿¡æ¯ï¼‰ï¼š
${JSON.stringify(materials, null, 2)}

è¯·åˆ†æå¹¶ç”¨JSONæ ¼å¼å›å¤ï¼ˆåªè¿”å›JSONï¼Œä¸è¦å…¶ä»–æ–‡å­—ï¼‰ï¼š
{
  "hasMatchingMaterials": true/false,
  "matchedMaterials": [
    {
      "materialId": ç´ æIDï¼ˆæ•°å­—ï¼‰,
      "materialName": "ç´ æåç§°",
      "reason": "æ¨èç†ç”±ï¼ˆ15-25å­—ï¼‰",
      "usage": "å»ºè®®ç”¨é€”ï¼ˆå¦‚ï¼šé€‚åˆåšå¼€å¤´ã€é€‚åˆåšB-rollã€é€‚åˆåšè½¬åœºï¼‰"
    }
  ],
  "missingMaterials": [
    {
      "type": "ç¼ºå°‘çš„ç´ æç±»å‹",
      "suggestion": "æ‹æ‘„å»ºè®®ï¼ˆ20-40å­—ï¼‰"
    }
  ],
  "topicSuggestions": [
    {
      "title": "é€‰é¢˜æ ‡é¢˜",
      "angle": "åˆ‡å…¥è§’åº¦",
      "reason": "ä¸ºä»€ä¹ˆé€‚åˆ"
    }
  ]
}

æ³¨æ„äº‹é¡¹ï¼š
1. å¦‚æœç´ æåº“ä¸­æœ‰ç¬¦åˆç”¨æˆ·æƒ³æ³•çš„ç´ æï¼Œè®¾ç½®hasMatchingMaterialsä¸ºtrueï¼Œå¹¶åœ¨matchedMaterialsä¸­æ¨è3-5ä¸ªæœ€åˆé€‚çš„ç´ æ
2. å³ä½¿æœ‰åŒ¹é…çš„ç´ æï¼Œä¹Ÿå¯ä»¥åœ¨missingMaterialsä¸­å»ºè®®ä¸€äº›èƒ½è®©è§†é¢‘æ›´å¥½çš„è¡¥å……ç´ æï¼ˆ1-3ä¸ªï¼‰
3. topicSuggestionsä¸­ç»™å‡º3ä¸ªå…·ä½“é€‰é¢˜å»ºè®®
4. materialIdå¿…é¡»æ˜¯ç´ æåº“ä¸­çœŸå®å­˜åœ¨çš„ID`;

            try {
                let requestConfig;

                if (provider.type === 'doubao') {
                    requestConfig = {
                        url: config.apiEndpoint,
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${config.apiKey}`
                        },
                        body: {
                            model: config.model,
                            messages: [{ role: "user", content: prompt }]
                        }
                    };
                } else if (provider.type === 'claude') {
                    requestConfig = {
                        url: config.apiEndpoint,
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": config.apiKey,
                            "anthropic-version": "2023-06-01"
                        },
                        body: {
                            model: config.model,
                            max_tokens: 2000,
                            messages: [{ role: "user", content: prompt }]
                        }
                    };
                } else {
                    requestConfig = {
                        url: config.apiEndpoint,
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${config.apiKey}`
                        },
                        body: {
                            model: config.model,
                            messages: [{ role: "user", content: prompt }]
                        }
                    };
                }

                const response = await fetch(requestConfig.url, {
                    method: "POST",
                    headers: requestConfig.headers,
                    body: JSON.stringify(requestConfig.body)
                });

                const data = await response.json();
                console.log('AIè¿”å›:', data);

                if (data.error) {
                    throw new Error(data.error.message || 'APIè°ƒç”¨å¤±è´¥');
                }

                let jsonText;
                if (provider.type === 'claude') {
                    jsonText = data.content[0].text;
                } else {
                    jsonText = data.choices[0].message.content;
                }

                jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const result = JSON.parse(jsonText);
                return result;
            } catch (error) {
                console.error('AIæ£€ç´¢é”™è¯¯:', error);
                throw error;
            }
        };

        // ==================== ä¸»åº”ç”¨ç»„ä»¶ ====================
        const ContentProductionApp = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [materials, setMaterials, materialsLoading] = usePersistedState('materials_v2', []);
            const [topics, setTopics, topicsLoading] = usePersistedState('topics_v2', []);
            const [videos, setVideos, videosLoading] = usePersistedState('videos_v2', []);
            
            // å¤šæ¨¡å‹é…ç½®
            const [aiProviders, setAiProviders, providersLoading] = usePersistedState('ai_providers', []);
            const [selectedProvider, setSelectedProvider, selectedLoading] = usePersistedState('selected_provider', null);

            // ç­‰å¾…æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆ
            if (materialsLoading || topicsLoading || videosLoading || providersLoading || selectedLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center justify-center">
                        <div className="text-center">
                            <i className="fas fa-spinner fa-spin text-6xl text-indigo-600 mb-4"></i>
                            <p className="text-xl text-gray-700">åŠ è½½ä¸­...</p>
                        </div>
                    </div>
                );
            }

            // å°†å½“å‰é€‰ä¸­çš„æ¨¡å‹é…ç½®æ³¨å…¥åˆ°å…¨å±€
            const currentProvider = aiProviders.find(p => p.id === selectedProvider);
            window.CURRENT_AI_PROVIDER = currentProvider || null;

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
                    {/* é¡¶éƒ¨å¯¼èˆª */}
                    <Header activeTab={activeTab} setActiveTab={setActiveTab} />

                    {/* ä¸»å†…å®¹åŒº */}
                    <main className="container mx-auto px-4 py-8">
                        {activeTab === 'home' && (
                            <AIHomePage 
                                materials={materials} 
                                setMaterials={setMaterials}
                                topics={topics}
                                setTopics={setTopics}
                            />
                        )}
                        {activeTab === 'materials' && (
                            <MaterialsManager materials={materials} setMaterials={setMaterials} />
                        )}
                        {activeTab === 'topics' && (
                            <TopicsManager topics={topics} setTopics={setTopics} />
                        )}
                        {activeTab === 'videos' && (
                            <VideosManager videos={videos} setVideos={setVideos} materials={materials} />
                        )}
                        {activeTab === 'analytics' && (
                            <Analytics videos={videos} />
                        )}
                        {activeTab === 'settings' && (
                            <SettingsPage 
                                aiProviders={aiProviders} 
                                setAiProviders={setAiProviders}
                                selectedProvider={selectedProvider}
                                setSelectedProvider={setSelectedProvider}
                            />
                        )}
                    </main>

                    {/* åº•éƒ¨ä¿¡æ¯ */}
                    <Footer materials={materials} topics={topics} videos={videos} />
                </div>
            );
        };

        // ==================== å¤´éƒ¨ç»„ä»¶ ====================
        const Header = ({ activeTab, setActiveTab }) => {
            const tabs = [
                { id: 'home', name: 'AI é¦–é¡µ', icon: 'fa-robot' },
                { id: 'materials', name: 'ç´ æåº“', icon: 'fa-photo-film' },
                { id: 'topics', name: 'é€‰é¢˜åº“', icon: 'fa-lightbulb' },
                { id: 'videos', name: 'æˆå“åº“', icon: 'fa-video' },
                { id: 'analytics', name: 'æ•°æ®åˆ†æ', icon: 'fa-chart-line' },
                { id: 'settings', name: 'è®¾ç½®', icon: 'fa-cog' }
            ];

            return (
                <header className="bg-white shadow-lg">
                    <div className="container mx-auto px-4">
                        <div className="flex items-center justify-between py-4">
                            <div className="flex items-center space-x-3">
                                <i className="fas fa-film text-3xl text-indigo-600"></i>
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800">çŸ­è§†é¢‘å†…å®¹ç”Ÿäº§ç³»ç»Ÿ</h1>
                                    <p className="text-sm text-gray-500">AIæ™ºèƒ½ç‰ˆ v3.2 (æ‰‹åŠ¨ç¼–è¾‘æ”¯æŒ) ğŸš€</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="flex flex-wrap gap-2">
                                    {tabs.map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`px-3 py-2 rounded-lg font-medium transition-all text-sm ${
                                                activeTab === tab.id
                                                    ? 'bg-indigo-600 text-white shadow-md'
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            <i className={`fas ${tab.icon} mr-1`}></i>
                                            <span className="hidden sm:inline">{tab.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // ==================== AI æ™ºèƒ½é¦–é¡µ ====================
        const AIHomePage = ({ materials, setMaterials, topics, setTopics }) => {
            const [idea, setIdea] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);

            const handleSearch = async () => {
                if (!idea.trim()) {
                    alert('è¯·è¾“å…¥ä½ çš„åˆ›ä½œæƒ³æ³•');
                    return;
                }

                if (materials.length === 0) {
                    alert('ç´ æåº“ä¸ºç©ºï¼Œè¯·å…ˆåˆ°"ç´ æåº“"æ·»åŠ ä¸€äº›ç´ æ');
                    return;
                }

                setLoading(true);
                setError(null);
                setResult(null);

                try {
                    const aiResult = await searchMaterialsWithAI(idea, materials);
                    setResult(aiResult);
                } catch (err) {
                    setError('AI åˆ†æå¤±è´¥ï¼š' + err.message + 'ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚');
                } finally {
                    setLoading(false);
                }
            };

            const handleAddTopic = (topicSuggestion) => {
                const newTopic = {
                    id: Date.now(),
                    title: topicSuggestion.title,
                    description: `${topicSuggestion.angle}\n\næ¨èç†ç”±ï¼š${topicSuggestion.reason}`,
                    source: 'AIæ¨è',
                    status: 'pending',
                    priority: 'high',
                    difficulty: 2,
                    createdAt: new Date().toISOString().split('T')[0]
                };
                setTopics([...topics, newTopic]);
                alert('âœ… é€‰é¢˜å·²æ·»åŠ åˆ°é€‰é¢˜åº“ï¼');
            };

            const handleUseMaterial = (materialId) => {
                const updatedMaterials = materials.map(m => {
                    if (m.id === materialId) {
                        return {
                            ...m,
                            usageCount: m.usageCount + 1,
                            lastUsed: new Date().toISOString().split('T')[0]
                        };
                    }
                    return m;
                });
                setMaterials(updatedMaterials);
                alert('âœ… ç´ æä½¿ç”¨æ¬¡æ•°å·²æ›´æ–°ï¼');
            };

            return (
                <div className="space-y-6">
                    {/* æ¬¢è¿å¡ç‰‡ */}
                    <div className="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-2xl p-8 text-white">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-3xl font-bold mb-2">ğŸ¤– AI æ™ºèƒ½åˆ›ä½œåŠ©æ‰‹</h1>
                                <p className="text-indigo-100 text-lg">è¾“å…¥ä½ çš„åˆ›ä½œæƒ³æ³•ï¼Œè®© AI å¸®ä½ æ‰¾åˆ°æœ€åˆé€‚çš„ç´ æå’Œé€‰é¢˜å»ºè®®</p>
                            </div>
                            <i className="fas fa-magic text-8xl text-white opacity-20"></i>
                        </div>
                    </div>

                    {/* AI æœç´¢æ¡† */}
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    <i className="fas fa-lightbulb text-yellow-500 mr-2"></i>
                                    ä½ æƒ³åšä»€ä¹ˆæ ·çš„çŸ­è§†é¢‘ï¼Ÿ
                                </label>
                                <textarea
                                    value={idea}
                                    onChange={(e) => setIdea(e.target.value)}
                                    placeholder="ä¾‹å¦‚ï¼šæƒ³åšä¸€æœŸå…³äºå’–å•¡æ‹‰èŠ±æŠ€å·§çš„æ•™å­¦è§†é¢‘&#10;ä¾‹å¦‚ï¼šåˆ†äº«æˆ‘çš„æ—¥å¸¸ vlogï¼Œå±•ç¤ºæˆ‘çš„å·¥ä½œç¯å¢ƒ&#10;ä¾‹å¦‚ï¼šä»‹ç»ä¸€æ¬¾å¥½ç”¨çš„æ‰‹æœº App"
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                                    rows="5"
                                />
                                <p className="text-sm text-gray-500 mt-2">
                                    <i className="fas fa-info-circle mr-1"></i>
                                    æç¤ºï¼šæè¿°è¶Šè¯¦ç»†ï¼ŒAI æ¨èçš„ç´ æè¶Šç²¾å‡†
                                </p>
                            </div>

                            <div className="flex justify-center">
                                <button
                                    onClick={handleSearch}
                                    disabled={loading || !idea.trim() || materials.length === 0}
                                    className={`px-8 py-4 rounded-xl font-bold text-lg transition-all ${
                                        loading || !idea.trim() || materials.length === 0
                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                            : 'bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:shadow-2xl hover:scale-105'
                                    }`}
                                >
                                    {loading ? (
                                        <>
                                            <i className="fas fa-spinner fa-spin mr-2"></i>
                                            AI åˆ†æä¸­...
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-search mr-2"></i>
                                            å¼€å§‹ AI æ£€ç´¢
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* é”™è¯¯æç¤º */}
                    {error && (
                        <div className="bg-red-50 border-2 border-red-200 rounded-xl p-6">
                            <div className="flex items-center gap-3">
                                <i className="fas fa-exclamation-circle text-3xl text-red-500"></i>
                                <div>
                                    <h3 className="font-bold text-red-800 mb-1">å‡ºé”™äº†</h3>
                                    <p className="text-red-600">{error}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI åˆ†æç»“æœ */}
                    {result && (
                        <div className="space-y-6">
                            {/* åŒ¹é…çš„ç´ æ */}
                            {result.hasMatchingMaterials && result.matchedMaterials && result.matchedMaterials.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="bg-green-100 rounded-full p-3">
                                            <i className="fas fa-check-circle text-2xl text-green-600"></i>
                                        </div>
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">æ‰¾åˆ°äº† {result.matchedMaterials.length} ä¸ªåˆé€‚çš„ç´ æï¼</h2>
                                            <p className="text-gray-600">è¿™äº›ç´ æéå¸¸é€‚åˆä½ çš„åˆ›ä½œæƒ³æ³•</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        {result.matchedMaterials.map((match, idx) => {
                                            const material = materials.find(m => m.id === match.materialId);
                                            if (!material) return null;
                                            return (
                                                <div key={idx} className="border-2 border-green-200 rounded-xl p-4 bg-green-50 hover:shadow-lg transition-all">
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div className="flex-1">
                                                            <h3 className="font-bold text-gray-800 mb-1">{material.name}</h3>
                                                            <p className="text-xs text-gray-600 mb-2">{material.scene}</p>
                                                            <div className="flex flex-wrap gap-1 mb-2">
                                                                {material.tags.slice(0, 3).map(tag => (
                                                                    <span key={tag} className="text-xs px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded-full">
                                                                        {tag}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        </div>
                                                        <span className="text-2xl">ğŸ¯</span>
                                                    </div>
                                                    
                                                    <div className="space-y-2 text-sm mb-4">
                                                        <div className="flex items-start gap-2">
                                                            <i className="fas fa-star text-yellow-500 mt-0.5 flex-shrink-0"></i>
                                                            <span className="text-gray-700">{match.reason}</span>
                                                        </div>
                                                        <div className="flex items-start gap-2">
                                                            <i className="fas fa-lightbulb text-purple-500 mt-0.5 flex-shrink-0"></i>
                                                            <span className="text-gray-700">{match.usage}</span>
                                                        </div>
                                                    </div>

                                                    <div className="text-xs text-gray-500 mb-3 pb-3 border-b">
                                                        <i className="fas fa-chart-bar mr-1"></i>
                                                        å·²ä½¿ç”¨ {material.usageCount} æ¬¡
                                                        {material.lastUsed && ` Â· ${material.lastUsed}`}
                                                    </div>

                                                    <button
                                                        onClick={() => handleUseMaterial(material.id)}
                                                        className="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium"
                                                    >
                                                        <i className="fas fa-check mr-1"></i>
                                                        æ ‡è®°ä½¿ç”¨
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {/* ç¼ºå°‘çš„ç´ æ */}
                            {result.missingMaterials && result.missingMaterials.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="bg-orange-100 rounded-full p-3">
                                            <i className="fas fa-camera text-2xl text-orange-600"></i>
                                        </div>
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">å»ºè®®æ‹æ‘„ä»¥ä¸‹ç´ æ</h2>
                                            <p className="text-gray-600">è¿™äº›ç´ æèƒ½è®©ä½ çš„è§†é¢‘æ›´å®Œæ•´</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {result.missingMaterials.map((missing, idx) => (
                                            <div key={idx} className="border-2 border-orange-200 rounded-xl p-4 bg-orange-50">
                                                <div className="flex items-start gap-3">
                                                    <i className="fas fa-exclamation-triangle text-orange-500 text-xl mt-1 flex-shrink-0"></i>
                                                    <div className="flex-1">
                                                        <h3 className="font-bold text-gray-800 mb-2">{missing.type}</h3>
                                                        <p className="text-gray-700 text-sm">{missing.suggestion}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* é€‰é¢˜å»ºè®® */}
                            {result.topicSuggestions && result.topicSuggestions.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="bg-purple-100 rounded-full p-3">
                                            <i className="fas fa-lightbulb text-2xl text-purple-600"></i>
                                        </div>
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800">AI ä¸ºä½ ç”Ÿæˆäº† {result.topicSuggestions.length} ä¸ªé€‰é¢˜</h2>
                                            <p className="text-gray-600">ç‚¹å‡»æ·»åŠ åˆ°é€‰é¢˜åº“</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        {result.topicSuggestions.map((topic, idx) => (
                                            <div key={idx} className="border-2 border-purple-200 rounded-xl p-4 bg-purple-50 hover:shadow-lg transition-all">
                                                <h3 className="font-bold text-gray-800 mb-2 text-lg">{topic.title}</h3>
                                                <div className="space-y-2 text-sm mb-4">
                                                    <p className="text-gray-700">
                                                        <strong className="text-purple-700">åˆ‡å…¥è§’åº¦ï¼š</strong>
                                                        {topic.angle}
                                                    </p>
                                                    <p className="text-gray-700">
                                                        <strong className="text-purple-700">æ¨èç†ç”±ï¼š</strong>
                                                        {topic.reason}
                                                    </p>
                                                </div>
                                                <button
                                                    onClick={() => handleAddTopic(topic)}
                                                    className="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium"
                                                >
                                                    <i className="fas fa-plus mr-1"></i>
                                                    æ·»åŠ åˆ°é€‰é¢˜åº“
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* å¿«æ·æ“ä½œ */}
                            <div className="bg-gradient-to-r from-indigo-100 to-purple-100 rounded-xl p-6 text-center">
                                <p className="text-gray-700 mb-4">
                                    <i className="fas fa-magic mr-2"></i>
                                    æ»¡æ„è¿™æ¬¡åˆ†æå—ï¼Ÿç»§ç»­ä¼˜åŒ–ä½ çš„åˆ›ä½œ
                                </p>
                                <button
                                    onClick={() => {
                                        setIdea('');
                                        setResult(null);
                                        setError(null);
                                    }}
                                    className="px-6 py-3 bg-white text-indigo-600 rounded-lg hover:shadow-lg transition-all font-medium"
                                >
                                    <i className="fas fa-redo mr-2"></i>
                                    é‡æ–°åˆ†æ
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== ç´ æåº“ç®¡ç† ====================
        const MaterialsManager = ({ materials, setMaterials }) => {
            const [showAddForm, setShowAddForm] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterTag, setFilterTag] = useState('all');

            const allTags = [...new Set(materials.flatMap(m => m.tags))];

            const filteredMaterials = materials.filter(m => {
                const matchSearch = m.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                  m.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase()));
                const matchFilter = filterTag === 'all' || m.tags.includes(filterTag);
                return matchSearch && matchFilter;
            });

            return (
                <div className="space-y-6">
                    {/* ç»Ÿè®¡å¡ç‰‡ */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <StatCard
                            icon="fa-photo-film"
                            title="æ€»ç´ ææ•°"
                            value={materials.length}
                            color="blue"
                        />
                        <StatCard
                            icon="fa-fire"
                            title="é«˜é¢‘ç´ æ"
                            value={materials.filter(m => m.usageCount >= 3).length}
                            color="red"
                        />
                        <StatCard
                            icon="fa-tags"
                            title="æ ‡ç­¾æ€»æ•°"
                            value={allTags.length}
                            color="green"
                        />
                        <StatCard
                            icon="fa-clock"
                            title="æœªä½¿ç”¨ç´ æ"
                            value={materials.filter(m => m.usageCount === 0).length}
                            color="yellow"
                        />
                    </div>

                    {/* æ“ä½œæ  */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <div className="mb-3 bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-800">
                            <i className="fas fa-info-circle mr-2"></i>
                            æç¤ºï¼šç‚¹å‡»ç´ æå¡ç‰‡å³ä¸Šè§’çš„ <i className="fas fa-edit text-blue-600 mx-1"></i> å›¾æ ‡å¯ä»¥ç¼–è¾‘ç´ æä¿¡æ¯
                        </div>
                        <div className="flex flex-col md:flex-row gap-4 items-center justify-between">
                            <div className="flex-1 w-full">
                                <div className="relative">
                                    <i className="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    <input
                                        type="text"
                                        placeholder="æœç´¢ç´ æåç§°æˆ–æ ‡ç­¾..."
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    />
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <select
                                    value={filterTag}
                                    onChange={(e) => setFilterTag(e.target.value)}
                                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                >
                                    <option value="all">æ‰€æœ‰æ ‡ç­¾</option>
                                    {allTags.map(tag => (
                                        <option key={tag} value={tag}>{tag}</option>
                                    ))}
                                </select>
                                <button
                                    onClick={() => setShowAddForm(true)}
                                    className="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:shadow-lg transition-colors font-medium"
                                >
                                    <i className="fas fa-cloud-upload-alt mr-2"></i>ä¸Šä¼ ç´ æ
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* æ·»åŠ ç´ æè¡¨å• */}
                    {showAddForm && (
                        <AddMaterialForm
                            onClose={() => setShowAddForm(false)}
                            onAdd={(material) => {
                                setMaterials([...materials, { ...material, id: Date.now(), usageCount: 0, lastUsed: null }]);
                                setShowAddForm(false);
                            }}
                        />
                    )}

                    {/* ç´ æåˆ—è¡¨ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredMaterials.length === 0 ? (
                            <div className="col-span-full text-center py-16">
                                <i className="fas fa-folder-open text-6xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 text-lg">
                                    {searchQuery || filterTag !== 'all' ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç´ æ' : 'è¿˜æ²¡æœ‰æ·»åŠ ç´ æï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ·»åŠ å§ï¼'}
                                </p>
                            </div>
                        ) : (
                            filteredMaterials.map(material => (
                                <MaterialCard
                                    key={material.id}
                                    material={material}
                                    onUpdate={(updated) => {
                                        setMaterials(materials.map(m => m.id === updated.id ? updated : m));
                                    }}
                                    onDelete={(id) => {
                                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç´ æå—ï¼Ÿ')) {
                                            setMaterials(materials.filter(m => m.id !== id));
                                        }
                                    }}
                                />
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // ==================== ç´ æå¡ç‰‡ ====================
        const MaterialCard = ({ material, onUpdate, onDelete }) => {
            const [showDetails, setShowDetails] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [editData, setEditData] = useState({
                name: material.name,
                scene: material.scene,
                tags: material.tags.join(', '),
                duration: material.duration || '',
                note: material.note || ''
            });

            const handleSaveEdit = () => {
                const updatedMaterial = {
                    ...material,
                    name: editData.name,
                    scene: editData.scene,
                    tags: editData.tags.split(',').map(t => t.trim()).filter(t => t),
                    duration: editData.duration,
                    note: editData.note
                };
                onUpdate(updatedMaterial);
                setIsEditing(false);
                alert('âœ… ç´ æä¿¡æ¯å·²æ›´æ–°ï¼');
            };

            const handleCancelEdit = () => {
                setEditData({
                    name: material.name,
                    scene: material.scene,
                    tags: material.tags.join(', '),
                    duration: material.duration || '',
                    note: material.note || ''
                });
                setIsEditing(false);
            };

            return (
                <div className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all">
                    {/* ç¼©ç•¥å›¾ */}
                    {material.thumbnail && (
                        <div className="h-48 bg-gray-200 overflow-hidden">
                            <img src={material.thumbnail} alt={material.name} className="w-full h-full object-cover" />
                        </div>
                    )}

                    <div className="p-4">
                        {isEditing ? (
                            // ç¼–è¾‘æ¨¡å¼
                            <div className="space-y-3">
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">ç´ æåç§°</label>
                                    <input
                                        type="text"
                                        value={editData.name}
                                        onChange={(e) => setEditData({ ...editData, name: e.target.value })}
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">åœºæ™¯æè¿°</label>
                                    <textarea
                                        value={editData.scene}
                                        onChange={(e) => setEditData({ ...editData, scene: e.target.value })}
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        rows="2"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                                    <input
                                        type="text"
                                        value={editData.tags}
                                        onChange={(e) => setEditData({ ...editData, tags: e.target.value })}
                                        placeholder="ä¾‹å¦‚ï¼šå’–å•¡, æ‹‰èŠ±, æ•™å­¦"
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">æ—¶é•¿</label>
                                    <input
                                        type="text"
                                        value={editData.duration}
                                        onChange={(e) => setEditData({ ...editData, duration: e.target.value })}
                                        placeholder="ä¾‹å¦‚ï¼š15ç§’"
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">å¤‡æ³¨</label>
                                    <textarea
                                        value={editData.note}
                                        onChange={(e) => setEditData({ ...editData, note: e.target.value })}
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        rows="2"
                                    />
                                </div>
                                <div className="flex gap-2 pt-2">
                                    <button
                                        onClick={handleSaveEdit}
                                        className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                    >
                                        <i className="fas fa-check mr-1"></i>ä¿å­˜
                                    </button>
                                    <button
                                        onClick={handleCancelEdit}
                                        className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors text-sm"
                                    >
                                        <i className="fas fa-times mr-1"></i>å–æ¶ˆ
                                    </button>
                                </div>
                            </div>
                        ) : (
                            // æŸ¥çœ‹æ¨¡å¼
                            <>
                                {/* æ ‡é¢˜ä¸æ“ä½œ */}
                                <div className="flex items-start justify-between mb-3">
                                    <h3 className="font-bold text-gray-800 text-lg flex-1">{material.name}</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setIsEditing(true)}
                                            className="text-blue-600 hover:text-blue-800 text-lg"
                                            title="ç¼–è¾‘ç´ æ"
                                        >
                                            <i className="fas fa-edit"></i>
                                        </button>
                                        <button
                                            onClick={() => setShowDetails(!showDetails)}
                                            className="text-gray-400 hover:text-indigo-600 text-lg"
                                            title="è¯¦æƒ…"
                                        >
                                            <i className={`fas fa-chevron-${showDetails ? 'up' : 'down'}`}></i>
                                        </button>
                                        <button
                                            onClick={() => onDelete(material.id)}
                                            className="text-red-400 hover:text-red-600 text-lg"
                                            title="åˆ é™¤"
                                        >
                                            <i className="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>

                                {/* åœºæ™¯æè¿° */}
                                <p className="text-sm text-gray-600 mb-3">{material.scene}</p>

                                {/* æ ‡ç­¾ */}
                                <div className="flex flex-wrap gap-2 mb-3">
                                    {material.tags.map(tag => (
                                        <span
                                            key={tag}
                                            className="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full"
                                        >
                                            {tag}
                                        </span>
                                    ))}
                                </div>

                                {/* ä½¿ç”¨ç»Ÿè®¡ - ä»…åœ¨æœ‰ä½¿ç”¨è®°å½•æ—¶æ˜¾ç¤º */}
                                {(material.usageCount > 0 || material.lastUsed) && (
                                    <div className="flex items-center justify-between text-sm mb-3 pb-3 border-b">
                                        <div className="flex items-center gap-4">
                                            {material.usageCount > 0 && (
                                                <span className="text-gray-600">
                                                    <i className="fas fa-chart-bar mr-1"></i>
                                                    ä½¿ç”¨ {material.usageCount} æ¬¡
                                                </span>
                                            )}
                                            {material.lastUsed && (
                                                <span className="text-gray-600">
                                                    <i className="fas fa-clock mr-1"></i>
                                                    {material.lastUsed}
                                                </span>
                                            )}
                                        </div>
                                        {material.usageCount >= 3 && (
                                            <span className="text-red-500 font-medium">
                                                <i className="fas fa-fire"></i> é«˜é¢‘
                                            </span>
                                        )}
                                    </div>
                                )}

                                {/* è¯¦ç»†ä¿¡æ¯ */}
                                {showDetails && (
                                    <div className="border-t pt-4 mt-4 space-y-2 text-sm">
                                        {material.duration && (
                                            <p><strong>æ—¶é•¿ï¼š</strong>{material.duration}</p>
                                        )}
                                        {material.note && (
                                            <p><strong>å¤‡æ³¨ï¼š</strong>{material.note}</p>
                                        )}
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // ==================== å‹ç¼©å›¾ç‰‡ ====================
        const compressImage = (base64Str, maxWidth = 800) => {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    // å¦‚æœå›¾ç‰‡å®½åº¦è¶…è¿‡maxWidthï¼ŒæŒ‰æ¯”ä¾‹ç¼©æ”¾
                    if (width > maxWidth) {
                        height = Math.round(height * (maxWidth / width));
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // å‹ç¼©è´¨é‡è®¾ä¸º0.7
                    resolve(canvas.toDataURL('image/jpeg', 0.7));
                };
                img.src = base64Str.startsWith('data:') ? base64Str : `data:image/jpeg;base64,${base64Str}`;
            });
        };

        // ==================== æ·»åŠ ç´ æè¡¨å• ====================
        const AddMaterialForm = ({ onClose, onAdd }) => {
            const [uploading, setUploading] = useState(false);
            const [analyzing, setAnalyzing] = useState(false);
            const [preview, setPreview] = useState(null);
            const [aiResult, setAiResult] = useState(null);
            const [fileInfo, setFileInfo] = useState(null);
            const [dragOver, setDragOver] = useState(false);
            const [error, setError] = useState(null);
            const [manualEdit, setManualEdit] = useState(false);
            const [manualData, setManualData] = useState({
                name: '',
                scene: '',
                tags: '',
                duration: '',
                note: ''
            });
            const fileInputRef = useRef(null);

            const handleFile = async (file) => {
                if (!file) return;
                setError(null);
                const fileType = file.type.startsWith('video/') ? 'video' : 'image';
                setUploading(true);
                setFileInfo({ name: file.name, type: fileType, size: (file.size / 1024 / 1024).toFixed(2) + ' MB' });
                
                try {
                    let thumbnail, base64;
                    if (fileType === 'video') {
                        thumbnail = await extractVideoFrame(file);
                        // å‹ç¼©è§†é¢‘ç¼©ç•¥å›¾
                        thumbnail = await compressImage(thumbnail);
                        base64 = thumbnail.split(',')[1];
                        setPreview(thumbnail);
                    } else {
                        base64 = await imageToBase64(file);
                        const fullImage = 'data:image/jpeg;base64,' + base64;
                        // å‹ç¼©å›¾ç‰‡
                        const compressed = await compressImage(fullImage);
                        setPreview(compressed);
                        base64 = compressed.split(',')[1];
                    }
                    setUploading(false);
                    setAnalyzing(true);
                    
                    const analysis = await analyzeImageWithAI(base64);
                    setAiResult(analysis);
                    setManualData({
                        name: analysis.suggestedName || file.name,
                        scene: analysis.scene || '',
                        tags: analysis.tags?.join(', ') || '',
                        duration: '',
                        note: `AIåˆ†æï¼š${analysis.usage || ''} | æƒ…ç»ªï¼š${analysis.mood || ''}`
                    });
                    setAnalyzing(false);
                } catch (error) {
                    console.error('å¤„ç†é”™è¯¯:', error);
                    setError('AIåˆ†æå¤±è´¥ï¼š' + error.message + 'ã€‚ä½ å¯ä»¥é€‰æ‹©æ‰‹åŠ¨å¡«å†™ä¿¡æ¯æˆ–é‡æ–°ä¸Šä¼ ã€‚');
                    setUploading(false);
                    setAnalyzing(false);
                    // AI å¤±è´¥åï¼Œè®¾ç½®é»˜è®¤å€¼ä¾›æ‰‹åŠ¨ç¼–è¾‘
                    setManualData({
                        name: file.name,
                        scene: '',
                        tags: '',
                        duration: '',
                        note: ''
                    });
                }
            };

            const save = () => {
                // ä½¿ç”¨æ‰‹åŠ¨ç¼–è¾‘çš„æ•°æ®æˆ–AIç»“æœ
                const dataToSave = manualEdit || !aiResult ? manualData : {
                    name: aiResult.suggestedName || fileInfo.name,
                    scene: aiResult.scene,
                    tags: aiResult.tags?.join(', '),
                    duration: '',
                    note: `AIåˆ†æï¼š${aiResult.usage} | æƒ…ç»ªï¼š${aiResult.mood}`
                };

                if (!dataToSave.name) {
                    setError('è¯·è‡³å°‘å¡«å†™ç´ æåç§°');
                    return;
                }
                
                try {
                    console.log('å¼€å§‹ä¿å­˜ç´ æ...', dataToSave);
                    
                    const newMaterial = {
                        name: dataToSave.name,
                        scene: dataToSave.scene || 'æœªæè¿°',
                        tags: dataToSave.tags ? dataToSave.tags.split(',').map(t => t.trim()).filter(t => t) : ['æœªåˆ†ç±»'],
                        duration: dataToSave.duration || '',
                        note: dataToSave.note || '',
                        thumbnail: preview
                    };
                    
                    console.log('ç´ ææ•°æ®å‡†å¤‡å®Œæˆï¼Œè°ƒç”¨ onAdd...');
                    onAdd(newMaterial);
                    console.log('ç´ æå·²æ·»åŠ ï¼Œå…³é—­å¼¹çª—...');
                    alert('âœ… ç´ æä¿å­˜æˆåŠŸï¼');
                    onClose();
                } catch (error) {
                    console.error('ä¿å­˜é”™è¯¯:', error);
                    setError('ä¿å­˜å¤±è´¥ï¼š' + error.message);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div className="p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">
                                    <i className="fas fa-cloud-upload-alt text-indigo-600 mr-2"></i>
                                    ä¸Šä¼ ç´ æ - AI è‡ªåŠ¨åˆ†æ
                                </h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-600 text-2xl">
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>

                            {error && (
                                <div className="mb-6 bg-red-50 border-2 border-red-200 rounded-lg p-4">
                                    <div className="flex items-center gap-2">
                                        <i className="fas fa-exclamation-circle text-red-500"></i>
                                        <p className="text-red-700 text-sm">{error}</p>
                                    </div>
                                    <button 
                                        onClick={() => {
                                            setError(null);
                                            setPreview(null);
                                            setAiResult(null);
                                            setFileInfo(null);
                                        }}
                                        className="mt-2 text-sm text-red-600 hover:text-red-800 underline"
                                    >
                                        é‡æ–°ä¸Šä¼ 
                                    </button>
                                </div>
                            )}

                            {!preview && (
                                <div
                                    className={`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${
                                        dragOver ? 'border-indigo-600 bg-indigo-100' : 'border-gray-300 hover:border-indigo-500 hover:bg-indigo-50'
                                    }`}
                                    onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                                    onDragLeave={() => setDragOver(false)}
                                    onDrop={(e) => {
                                        e.preventDefault();
                                        setDragOver(false);
                                        const file = e.dataTransfer.files[0];
                                        if (file && (file.type.startsWith('video/') || file.type.startsWith('image/'))) {
                                            handleFile(file);
                                        } else {
                                            alert('è¯·ä¸Šä¼ è§†é¢‘æˆ–å›¾ç‰‡æ–‡ä»¶');
                                        }
                                    }}
                                    onClick={() => fileInputRef.current?.click()}
                                >
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        accept="video/*,image/*"
                                        onChange={(e) => handleFile(e.target.files[0])}
                                        className="hidden"
                                    />
                                    {uploading ? (
                                        <>
                                            <i className="fas fa-spinner fa-spin text-6xl text-indigo-600 mb-4"></i>
                                            <p className="text-lg font-medium text-gray-700">å¤„ç†æ–‡ä»¶ä¸­...</p>
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                                            <p className="text-lg font-medium text-gray-700">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</p>
                                            <p className="text-sm text-gray-500 mt-2">æ”¯æŒè§†é¢‘ï¼ˆMP4, MOVï¼‰å’Œå›¾ç‰‡ï¼ˆJPG, PNGï¼‰</p>
                                        </>
                                    )}
                                </div>
                            )}

                            {preview && (
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {/* é¢„è§ˆ */}
                                        <div>
                                            <h3 className="font-bold text-gray-800 mb-3">é¢„è§ˆ</h3>
                                            <img src={preview} alt="é¢„è§ˆ" className="w-full rounded-lg shadow-md" />
                                            <div className="mt-3 text-sm text-gray-600">
                                                <p><i className="fas fa-file mr-2"></i>{fileInfo.name}</p>
                                                <p><i className="fas fa-hdd mr-2"></i>{fileInfo.size}</p>
                                            </div>
                                        </div>

                                        {/* AI åˆ†æç»“æœæˆ–æ‰‹åŠ¨ç¼–è¾‘ */}
                                        <div>
                                            <div className="flex items-center justify-between mb-3">
                                                <h3 className="font-bold text-gray-800">
                                                    {manualEdit ? 'æ‰‹åŠ¨ç¼–è¾‘' : 'AI åˆ†æç»“æœ'}
                                                </h3>
                                                {(aiResult || error) && (
                                                    <button
                                                        onClick={() => setManualEdit(!manualEdit)}
                                                        className="text-sm text-indigo-600 hover:text-indigo-800"
                                                    >
                                                        <i className={`fas ${manualEdit ? 'fa-robot' : 'fa-edit'} mr-1`}></i>
                                                        {manualEdit ? 'æŸ¥çœ‹AIç»“æœ' : 'æ‰‹åŠ¨ç¼–è¾‘'}
                                                    </button>
                                                )}
                                            </div>

                                            {analyzing ? (
                                                <div className="flex items-center justify-center h-64">
                                                    <div className="text-center">
                                                        <i className="fas fa-robot fa-spin text-5xl text-indigo-600 mb-3"></i>
                                                        <p className="text-gray-700">AI æ­£åœ¨åˆ†æç´ æ...</p>
                                                    </div>
                                                </div>
                                            ) : manualEdit || !aiResult ? (
                                                // æ‰‹åŠ¨ç¼–è¾‘è¡¨å•
                                                <div className="space-y-3">
                                                    <div>
                                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                                            ç´ æåç§° *
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={manualData.name}
                                                            onChange={(e) => setManualData({...manualData, name: e.target.value})}
                                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                            placeholder="è¾“å…¥ç´ æåç§°"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                                            åœºæ™¯æè¿°
                                                        </label>
                                                        <textarea
                                                            value={manualData.scene}
                                                            onChange={(e) => setManualData({...manualData, scene: e.target.value})}
                                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                            rows="3"
                                                            placeholder="æè¿°ç´ æçš„åœºæ™¯å†…å®¹"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                                            æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={manualData.tags}
                                                            onChange={(e) => setManualData({...manualData, tags: e.target.value})}
                                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                            placeholder="ä¾‹å¦‚ï¼šå’–å•¡, æ‹‰èŠ±, æ•™å­¦"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                                            æ—¶é•¿
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={manualData.duration}
                                                            onChange={(e) => setManualData({...manualData, duration: e.target.value})}
                                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                            placeholder="ä¾‹å¦‚ï¼š15ç§’"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium text-gray-700 mb-1">
                                                            å¤‡æ³¨
                                                        </label>
                                                        <textarea
                                                            value={manualData.note}
                                                            onChange={(e) => setManualData({...manualData, note: e.target.value})}
                                                            className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                            rows="2"
                                                            placeholder="å…¶ä»–å¤‡æ³¨ä¿¡æ¯"
                                                        />
                                                    </div>
                                                </div>
                                            ) : (
                                                // AI åˆ†æç»“æœæ˜¾ç¤º
                                                <div className="space-y-4">
                                                    <div className="bg-indigo-50 rounded-lg p-4">
                                                        <label className="text-sm font-medium text-gray-700">å»ºè®®æ–‡ä»¶å</label>
                                                        <p className="text-gray-800 mt-1">{aiResult.suggestedName}</p>
                                                    </div>
                                                    <div className="bg-purple-50 rounded-lg p-4">
                                                        <label className="text-sm font-medium text-gray-700">åœºæ™¯æè¿°</label>
                                                        <p className="text-gray-800 mt-1">{aiResult.scene}</p>
                                                    </div>
                                                    <div className="bg-green-50 rounded-lg p-4">
                                                        <label className="text-sm font-medium text-gray-700">æ ‡ç­¾</label>
                                                        <div className="flex flex-wrap gap-2 mt-2">
                                                            {aiResult.tags?.map(tag => (
                                                                <span key={tag} className="px-3 py-1 bg-green-600 text-white rounded-full text-sm">
                                                                    {tag}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <div className="bg-orange-50 rounded-lg p-4">
                                                        <label className="text-sm font-medium text-gray-700">ä½¿ç”¨å»ºè®®</label>
                                                        <p className="text-gray-800 mt-1">{aiResult.usage}</p>
                                                    </div>
                                                    <div className="bg-pink-50 rounded-lg p-4">
                                                        <label className="text-sm font-medium text-gray-700">æƒ…ç»ªæ°›å›´</label>
                                                        <p className="text-gray-800 mt-1">{aiResult.mood}</p>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="flex gap-3 justify-end">
                                        <button
                                            onClick={onClose}
                                            className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                        >
                                            å–æ¶ˆ
                                        </button>
                                        <button
                                            onClick={save}
                                            disabled={analyzing}
                                            className={`px-6 py-2 rounded-lg font-medium ${
                                                analyzing
                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                    : 'bg-indigo-600 text-white hover:bg-indigo-700'
                                            }`}
                                        >
                                            <i className="fas fa-check mr-2"></i>
                                            ä¿å­˜ç´ æ
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== é€‰é¢˜åº“ç®¡ç† ====================
        const TopicsManager = ({ topics, setTopics }) => {
            const [showAddForm, setShowAddForm] = useState(false);
            const [filter, setFilter] = useState('all');

            const filteredTopics = topics.filter(t => {
                if (filter === 'all') return true;
                return t.status === filter;
            });

            const statusMap = {
                pending: { label: 'å¾…åˆ¶ä½œ', color: 'yellow', icon: 'fa-clock' },
                inProgress: { label: 'åˆ¶ä½œä¸­', color: 'blue', icon: 'fa-spinner' },
                completed: { label: 'å·²å®Œæˆ', color: 'green', icon: 'fa-check' }
            };

            return (
                <div className="space-y-6">
                    {/* ç»Ÿè®¡å¡ç‰‡ */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <StatCard icon="fa-lightbulb" title="æ€»é€‰é¢˜æ•°" value={topics.length} color="purple" />
                        <StatCard icon="fa-clock" title="å¾…åˆ¶ä½œ" value={topics.filter(t => t.status === 'pending').length} color="yellow" />
                        <StatCard icon="fa-spinner" title="åˆ¶ä½œä¸­" value={topics.filter(t => t.status === 'inProgress').length} color="blue" />
                        <StatCard icon="fa-check" title="å·²å®Œæˆ" value={topics.filter(t => t.status === 'completed').length} color="green" />
                    </div>

                    {/* æ“ä½œæ  */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <div className="flex flex-col md:flex-row gap-4 items-center justify-between">
                            <div className="flex gap-2">
                                {['all', 'pending', 'inProgress', 'completed'].map(s => (
                                    <button
                                        key={s}
                                        onClick={() => setFilter(s)}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            filter === s
                                                ? 'bg-indigo-600 text-white'
                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                    >
                                        {s === 'all' ? 'å…¨éƒ¨' : statusMap[s].label}
                                    </button>
                                ))}
                            </div>
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:shadow-lg transition-colors font-medium"
                            >
                                <i className="fas fa-plus mr-2"></i>æ·»åŠ é€‰é¢˜
                            </button>
                        </div>
                    </div>

                    {/* æ·»åŠ é€‰é¢˜è¡¨å• */}
                    {showAddForm && (
                        <AddTopicForm
                            onClose={() => setShowAddForm(false)}
                            onAdd={(topic) => {
                                setTopics([...topics, { ...topic, id: Date.now(), createdAt: new Date().toISOString().split('T')[0] }]);
                                setShowAddForm(false);
                            }}
                        />
                    )}

                    {/* é€‰é¢˜åˆ—è¡¨ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredTopics.length === 0 ? (
                            <div className="col-span-full text-center py-16">
                                <i className="fas fa-lightbulb text-6xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 text-lg">
                                    {filter !== 'all' ? 'è¯¥çŠ¶æ€ä¸‹æ²¡æœ‰é€‰é¢˜' : 'è¿˜æ²¡æœ‰æ·»åŠ é€‰é¢˜ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ·»åŠ å§ï¼'}
                                </p>
                            </div>
                        ) : (
                            filteredTopics.map(topic => (
                                <TopicCard
                                    key={topic.id}
                                    topic={topic}
                                    statusMap={statusMap}
                                    onUpdate={(updated) => {
                                        setTopics(topics.map(t => t.id === updated.id ? updated : t));
                                    }}
                                    onDelete={(id) => {
                                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé€‰é¢˜å—ï¼Ÿ')) {
                                            setTopics(topics.filter(t => t.id !== id));
                                        }
                                    }}
                                />
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // ==================== é€‰é¢˜å¡ç‰‡ ====================
        const TopicCard = ({ topic, statusMap, onUpdate, onDelete }) => {
            const [showDetails, setShowDetails] = useState(false);
            const [isEditing, setIsEditing] = useState(false);
            const [editData, setEditData] = useState({
                title: topic.title,
                description: topic.description,
                source: topic.source,
                priority: topic.priority,
                difficulty: topic.difficulty
            });

            const status = statusMap[topic.status];

            const priorityMap = {
                low: { label: 'ä½', color: 'green' },
                medium: { label: 'ä¸­', color: 'yellow' },
                high: { label: 'é«˜', color: 'red' }
            };

            const handleSaveEdit = () => {
                const updatedTopic = {
                    ...topic,
                    title: editData.title,
                    description: editData.description,
                    source: editData.source,
                    priority: editData.priority,
                    difficulty: editData.difficulty
                };
                onUpdate(updatedTopic);
                setIsEditing(false);
                alert('âœ… é€‰é¢˜ä¿¡æ¯å·²æ›´æ–°ï¼');
            };

            const handleCancelEdit = () => {
                setEditData({
                    title: topic.title,
                    description: topic.description,
                    source: topic.source,
                    priority: topic.priority,
                    difficulty: topic.difficulty
                });
                setIsEditing(false);
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-5 hover:shadow-xl transition-all">
                    {isEditing ? (
                        // ç¼–è¾‘æ¨¡å¼
                        <div className="space-y-3">
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">é€‰é¢˜æ ‡é¢˜</label>
                                <input
                                    type="text"
                                    value={editData.title}
                                    onChange={(e) => setEditData({ ...editData, title: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">é€‰é¢˜æè¿°</label>
                                <textarea
                                    value={editData.description}
                                    onChange={(e) => setEditData({ ...editData, description: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    rows="3"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">æ¥æº</label>
                                <input
                                    type="text"
                                    value={editData.source}
                                    onChange={(e) => setEditData({ ...editData, source: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">ä¼˜å…ˆçº§</label>
                                    <select
                                        value={editData.priority}
                                        onChange={(e) => setEditData({ ...editData, priority: e.target.value })}
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    >
                                        <option value="low">ä½</option>
                                        <option value="medium">ä¸­</option>
                                        <option value="high">é«˜</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">éš¾åº¦</label>
                                    <select
                                        value={editData.difficulty}
                                        onChange={(e) => setEditData({ ...editData, difficulty: parseInt(e.target.value) })}
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    >
                                        <option value="1">â­ ç®€å•</option>
                                        <option value="2">â­â­ ä¸­ç­‰</option>
                                        <option value="3">â­â­â­ å›°éš¾</option>
                                    </select>
                                </div>
                            </div>
                            <div className="flex gap-2 pt-2">
                                <button
                                    onClick={handleSaveEdit}
                                    className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                >
                                    <i className="fas fa-check mr-1"></i>ä¿å­˜
                                </button>
                                <button
                                    onClick={handleCancelEdit}
                                    className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors text-sm"
                                >
                                    <i className="fas fa-times mr-1"></i>å–æ¶ˆ
                                </button>
                            </div>
                        </div>
                    ) : (
                        // æŸ¥çœ‹æ¨¡å¼
                        <>
                            <div className="flex items-start justify-between mb-3">
                                <h3 className="font-bold text-gray-800 text-lg flex-1">{topic.title}</h3>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setIsEditing(true)}
                                        className="text-blue-600 hover:text-blue-800 text-lg"
                                        title="ç¼–è¾‘é€‰é¢˜"
                                    >
                                        <i className="fas fa-edit"></i>
                                    </button>
                                    <button
                                        onClick={() => setShowDetails(!showDetails)}
                                        className="text-gray-400 hover:text-indigo-600 text-lg"
                                        title="è¯¦æƒ…"
                                    >
                                        <i className={`fas fa-chevron-${showDetails ? 'up' : 'down'}`}></i>
                                    </button>
                                    <button
                                        onClick={() => onDelete(topic.id)}
                                        className="text-red-400 hover:text-red-600 text-lg"
                                        title="åˆ é™¤"
                                    >
                                        <i className="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <p className="text-sm text-gray-600 mb-4 line-clamp-3">{topic.description}</p>

                            <div className="flex items-center gap-3 mb-4">
                                <span className={`px-3 py-1 bg-${status.color}-100 text-${status.color}-700 text-xs rounded-full font-medium`}>
                                    <i className={`fas ${status.icon} mr-1`}></i>
                                    {status.label}
                                </span>
                                <span className={`px-3 py-1 bg-${priorityMap[topic.priority].color}-100 text-${priorityMap[topic.priority].color}-700 text-xs rounded-full`}>
                                    ä¼˜å…ˆçº§: {priorityMap[topic.priority].label}
                                </span>
                            </div>

                            {showDetails && (
                                <div className="border-t pt-4 mt-4 space-y-2 text-sm">
                                    <p><strong>æ¥æºï¼š</strong>{topic.source}</p>
                                    <p><strong>éš¾åº¦ï¼š</strong>{'â­'.repeat(topic.difficulty)}</p>
                                    <p><strong>åˆ›å»ºæ—¶é—´ï¼š</strong>{topic.createdAt}</p>
                                </div>
                            )}

                            <div className="mt-4 pt-4 border-t flex gap-2">
                                {topic.status !== 'completed' && (
                                    <button
                                        onClick={() => {
                                            const nextStatus = topic.status === 'pending' ? 'inProgress' : 'completed';
                                            onUpdate({ ...topic, status: nextStatus });
                                        }}
                                        className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm"
                                    >
                                        <i className="fas fa-arrow-right mr-1"></i>
                                        {topic.status === 'pending' ? 'å¼€å§‹åˆ¶ä½œ' : 'æ ‡è®°å®Œæˆ'}
                                    </button>
                                )}
                                {topic.status === 'completed' && (
                                    <button
                                        onClick={() => onUpdate({ ...topic, status: 'pending' })}
                                        className="flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-sm"
                                    >
                                        <i className="fas fa-redo mr-1"></i>
                                        é‡ç½®çŠ¶æ€
                                    </button>
                                )}
                            </div>
                        </>
                    )}
                </div>
            );
        };

        // ==================== æ·»åŠ é€‰é¢˜è¡¨å• ====================
        const AddTopicForm = ({ onClose, onAdd }) => {
            const [formData, setFormData] = useState({
                title: '',
                description: '',
                source: 'æ‰‹åŠ¨æ·»åŠ ',
                status: 'pending',
                priority: 'medium',
                difficulty: 2
            });

            const handleSubmit = () => {
                if (!formData.title || !formData.description) {
                    alert('è¯·å¡«å†™æ ‡é¢˜å’Œæè¿°');
                    return;
                }
                onAdd(formData);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full">
                        <div className="p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">
                                    <i className="fas fa-plus text-indigo-600 mr-2"></i>
                                    æ·»åŠ é€‰é¢˜
                                </h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-600 text-2xl">
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">é€‰é¢˜æ ‡é¢˜ *</label>
                                    <input
                                        type="text"
                                        value={formData.title}
                                        onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                                        placeholder="ä¾‹å¦‚ï¼šå’–å•¡æ‹‰èŠ±æ•™å­¦"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">é€‰é¢˜æè¿° *</label>
                                    <textarea
                                        value={formData.description}
                                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                                        placeholder="è¯¦ç»†æè¿°é€‰é¢˜å†…å®¹ã€æ‹æ‘„è¦ç‚¹ç­‰"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        rows="4"
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">ä¼˜å…ˆçº§</label>
                                        <select
                                            value={formData.priority}
                                            onChange={(e) => setFormData({ ...formData, priority: e.target.value })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        >
                                            <option value="low">ä½</option>
                                            <option value="medium">ä¸­</option>
                                            <option value="high">é«˜</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">éš¾åº¦</label>
                                        <select
                                            value={formData.difficulty}
                                            onChange={(e) => setFormData({ ...formData, difficulty: parseInt(e.target.value) })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        >
                                            <option value="1">â­ ç®€å•</option>
                                            <option value="2">â­â­ ä¸­ç­‰</option>
                                            <option value="3">â­â­â­ å›°éš¾</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">æ¥æº</label>
                                    <input
                                        type="text"
                                        value={formData.source}
                                        onChange={(e) => setFormData({ ...formData, source: e.target.value })}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>
                            </div>

                            <div className="flex gap-3 justify-end mt-6">
                                <button
                                    onClick={onClose}
                                    className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                >
                                    å–æ¶ˆ
                                </button>
                                <button
                                    onClick={handleSubmit}
                                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                >
                                    <i className="fas fa-check mr-2"></i>
                                    æ·»åŠ 
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== æˆå“åº“ç®¡ç† ====================
        const VideosManager = ({ videos, setVideos, materials }) => {
            const [showAddForm, setShowAddForm] = useState(false);

            return (
                <div className="space-y-6">
                    {/* ç»Ÿè®¡å¡ç‰‡ */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <StatCard icon="fa-video" title="æ€»è§†é¢‘æ•°" value={videos.length} color="blue" />
                        <StatCard icon="fa-eye" title="æ€»æ’­æ”¾é‡" value={videos.reduce((sum, v) => sum + (v.views || 0), 0).toLocaleString()} color="purple" />
                        <StatCard icon="fa-heart" title="æ€»ç‚¹èµæ•°" value={videos.reduce((sum, v) => sum + (v.likes || 0), 0).toLocaleString()} color="red" />
                        <StatCard icon="fa-fire" title="çˆ†æ¬¾è§†é¢‘" value={videos.filter(v => v.views >= 100000).length} color="orange" />
                    </div>

                    {/* æ“ä½œæ  */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <div className="flex justify-end">
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:shadow-lg transition-colors font-medium"
                            >
                                <i className="fas fa-plus mr-2"></i>æ·»åŠ è§†é¢‘
                            </button>
                        </div>
                    </div>

                    {/* æ·»åŠ è§†é¢‘è¡¨å• */}
                    {showAddForm && (
                        <AddVideoForm
                            materials={materials}
                            onClose={() => setShowAddForm(false)}
                            onAdd={(video) => {
                                setVideos([...videos, { ...video, id: Date.now() }]);
                                setShowAddForm(false);
                            }}
                        />
                    )}

                    {/* è§†é¢‘åˆ—è¡¨ */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {videos.length === 0 ? (
                            <div className="col-span-full text-center py-16">
                                <i className="fas fa-video text-6xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 text-lg">è¿˜æ²¡æœ‰æ·»åŠ è§†é¢‘ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ·»åŠ å§ï¼</p>
                            </div>
                        ) : (
                            videos.map(video => (
                                <VideoCard
                                    key={video.id}
                                    video={video}
                                    onUpdate={(updated) => {
                                        setVideos(videos.map(v => v.id === updated.id ? updated : v));
                                    }}
                                    onDelete={(id) => {
                                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§†é¢‘å—ï¼Ÿ')) {
                                            setVideos(videos.filter(v => v.id !== id));
                                        }
                                    }}
                                />
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // ==================== è§†é¢‘å¡ç‰‡ ====================
        const VideoCard = ({ video, onUpdate, onDelete }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [editData, setEditData] = useState({ 
                title: video.title,
                publishDate: video.publishDate,
                views: video.views || 0, 
                likes: video.likes || 0, 
                completion: video.completion || 0 
            });

            const handleSaveEdit = () => {
                const updatedVideo = {
                    ...video,
                    title: editData.title,
                    publishDate: editData.publishDate,
                    views: parseInt(editData.views) || 0,
                    likes: parseInt(editData.likes) || 0,
                    completion: parseInt(editData.completion) || 0
                };
                onUpdate(updatedVideo);
                setIsEditing(false);
                alert('âœ… è§†é¢‘ä¿¡æ¯å·²æ›´æ–°ï¼');
            };

            const handleCancelEdit = () => {
                setEditData({
                    title: video.title,
                    publishDate: video.publishDate,
                    views: video.views || 0,
                    likes: video.likes || 0,
                    completion: video.completion || 0
                });
                setIsEditing(false);
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-5 hover:shadow-xl transition-all">
                    {isEditing ? (
                        // ç¼–è¾‘æ¨¡å¼
                        <div className="space-y-3">
                            <div className="flex items-start justify-between mb-3">
                                <h3 className="font-bold text-gray-800 text-lg">ç¼–è¾‘è§†é¢‘ä¿¡æ¯</h3>
                                <button
                                    onClick={() => onDelete(video.id)}
                                    className="text-gray-400 hover:text-red-600"
                                    title="åˆ é™¤"
                                >
                                    <i className="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">è§†é¢‘æ ‡é¢˜</label>
                                <input
                                    type="text"
                                    value={editData.title}
                                    onChange={(e) => setEditData({ ...editData, title: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">å‘å¸ƒæ—¥æœŸ</label>
                                <input
                                    type="date"
                                    value={editData.publishDate}
                                    onChange={(e) => setEditData({ ...editData, publishDate: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">æ’­æ”¾é‡</label>
                                <input
                                    type="number"
                                    value={editData.views}
                                    onChange={(e) => setEditData({ ...editData, views: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">ç‚¹èµæ•°</label>
                                <input
                                    type="number"
                                    value={editData.likes}
                                    onChange={(e) => setEditData({ ...editData, likes: e.target.value })}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-xs font-medium text-gray-700 mb-1">å®Œæ’­ç‡ (%)</label>
                                <input
                                    type="number"
                                    value={editData.completion}
                                    onChange={(e) => setEditData({ ...editData, completion: e.target.value })}
                                    min="0"
                                    max="100"
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                />
                            </div>
                            
                            <div className="flex gap-2 pt-2">
                                <button
                                    onClick={handleSaveEdit}
                                    className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                >
                                    <i className="fas fa-check mr-1"></i>ä¿å­˜
                                </button>
                                <button
                                    onClick={handleCancelEdit}
                                    className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors text-sm"
                                >
                                    <i className="fas fa-times mr-1"></i>å–æ¶ˆ
                                </button>
                            </div>
                        </div>
                    ) : (
                        // æŸ¥çœ‹æ¨¡å¼
                        <>
                            <div className="flex items-start justify-between mb-3">
                                <h3 className="font-bold text-gray-800 text-lg flex-1">{video.title}</h3>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setIsEditing(true)}
                                        className="text-blue-600 hover:text-blue-800 text-lg"
                                        title="ç¼–è¾‘è§†é¢‘"
                                    >
                                        <i className="fas fa-edit"></i>
                                    </button>
                                    <button
                                        onClick={() => onDelete(video.id)}
                                        className="text-red-400 hover:text-red-600 text-lg"
                                        title="åˆ é™¤"
                                    >
                                        <i className="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <div className="space-y-3 mb-4">
                                <div className="flex items-center justify-between text-sm">
                                    <span className="text-gray-600"><i className="fas fa-calendar mr-1"></i>å‘å¸ƒæ—¥æœŸ</span>
                                    <span className="font-medium">{video.publishDate}</span>
                                </div>
                                <div className="flex items-center justify-between text-sm">
                                    <span className="text-gray-600"><i className="fas fa-eye mr-1"></i>æ’­æ”¾é‡</span>
                                    <span className="font-medium text-blue-600">{(video.views || 0).toLocaleString()}</span>
                                </div>
                                <div className="flex items-center justify-between text-sm">
                                    <span className="text-gray-600"><i className="fas fa-heart mr-1"></i>ç‚¹èµæ•°</span>
                                    <span className="font-medium text-red-600">{(video.likes || 0).toLocaleString()}</span>
                                </div>
                                <div className="flex items-center justify-between text-sm">
                                    <span className="text-gray-600"><i className="fas fa-chart-line mr-1"></i>å®Œæ’­ç‡</span>
                                    <span className="font-medium text-green-600">{video.completion || 0}%</span>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        // ==================== æ·»åŠ è§†é¢‘è¡¨å• ====================
        const AddVideoForm = ({ materials, onClose, onAdd }) => {
            const [formData, setFormData] = useState({
                title: '',
                publishDate: new Date().toISOString().split('T')[0],
                usedMaterials: [],
                views: 0,
                likes: 0,
                completion: 0
            });

            const handleSubmit = () => {
                if (!formData.title) {
                    alert('è¯·å¡«å†™è§†é¢‘æ ‡é¢˜');
                    return;
                }
                onAdd(formData);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full">
                        <div className="p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">
                                    <i className="fas fa-plus text-indigo-600 mr-2"></i>
                                    æ·»åŠ è§†é¢‘
                                </h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-600 text-2xl">
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">è§†é¢‘æ ‡é¢˜ *</label>
                                    <input
                                        type="text"
                                        value={formData.title}
                                        onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                                        placeholder="ä¾‹å¦‚ï¼šå’–å•¡æ‹‰èŠ±å…¥é—¨æ•™ç¨‹"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">å‘å¸ƒæ—¥æœŸ</label>
                                    <input
                                        type="date"
                                        value={formData.publishDate}
                                        onChange={(e) => setFormData({ ...formData, publishDate: e.target.value })}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                    />
                                </div>

                                <div className="grid grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">æ’­æ”¾é‡</label>
                                        <input
                                            type="number"
                                            value={formData.views}
                                            onChange={(e) => setFormData({ ...formData, views: parseInt(e.target.value) || 0 })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">ç‚¹èµæ•°</label>
                                        <input
                                            type="number"
                                            value={formData.likes}
                                            onChange={(e) => setFormData({ ...formData, likes: parseInt(e.target.value) || 0 })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">å®Œæ’­ç‡ (%)</label>
                                        <input
                                            type="number"
                                            value={formData.completion}
                                            onChange={(e) => setFormData({ ...formData, completion: parseInt(e.target.value) || 0 })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-3 justify-end mt-6">
                                <button
                                    onClick={onClose}
                                    className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                >
                                    å–æ¶ˆ
                                </button>
                                <button
                                    onClick={handleSubmit}
                                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                >
                                    <i className="fas fa-check mr-2"></i>
                                    æ·»åŠ 
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== æ•°æ®åˆ†æé¡µé¢ ====================
        const Analytics = ({ videos }) => {
            const totalViews = videos.reduce((sum, v) => sum + (v.views || 0), 0);
            const totalLikes = videos.reduce((sum, v) => sum + (v.likes || 0), 0);
            const avgCompletion = videos.length > 0 
                ? Math.round(videos.reduce((sum, v) => sum + (v.completion || 0), 0) / videos.length)
                : 0;
            
            const hotVideos = videos
                .filter(v => v.views >= 100000)
                .sort((a, b) => b.views - a.views)
                .slice(0, 5);
            
            const recentVideos = [...videos]
                .sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate))
                .slice(0, 5);

            return (
                <div className="space-y-6">
                    {/* æ€»è§ˆç»Ÿè®¡ */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <StatCard
                            icon="fa-video"
                            title="æ€»è§†é¢‘æ•°"
                            value={videos.length}
                            color="blue"
                        />
                        <StatCard
                            icon="fa-eye"
                            title="æ€»æ’­æ”¾é‡"
                            value={totalViews.toLocaleString()}
                            color="purple"
                        />
                        <StatCard
                            icon="fa-heart"
                            title="æ€»ç‚¹èµæ•°"
                            value={totalLikes.toLocaleString()}
                            color="red"
                        />
                        <StatCard
                            icon="fa-chart-line"
                            title="å¹³å‡å®Œæ’­ç‡"
                            value={`${avgCompletion}%`}
                            color="green"
                        />
                    </div>

                    {/* çˆ†æ¬¾è§†é¢‘ */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">
                            <i className="fas fa-fire text-red-500 mr-2"></i>
                            çˆ†æ¬¾è§†é¢‘ TOP 5
                        </h2>
                        {hotVideos.length === 0 ? (
                            <p className="text-gray-500 text-center py-8">æš‚æ— æ’­æ”¾é‡è¶…è¿‡10ä¸‡çš„è§†é¢‘</p>
                        ) : (
                            <div className="space-y-3">
                                {hotVideos.map((video, idx) => (
                                    <div key={video.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                        <div className="flex items-center gap-4">
                                            <span className="text-2xl font-bold text-gray-300">#{idx + 1}</span>
                                            <div>
                                                <h3 className="font-bold text-gray-800">{video.title}</h3>
                                                <p className="text-sm text-gray-500">{video.publishDate}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-lg font-bold text-blue-600">
                                                {video.views.toLocaleString()} æ’­æ”¾
                                            </p>
                                            <p className="text-sm text-gray-500">
                                                {video.likes.toLocaleString()} ç‚¹èµ
                                            </p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* æœ€è¿‘å‘å¸ƒ */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">
                            <i className="fas fa-calendar text-indigo-600 mr-2"></i>
                            æœ€è¿‘å‘å¸ƒ
                        </h2>
                        {recentVideos.length === 0 ? (
                            <p className="text-gray-500 text-center py-8">è¿˜æ²¡æœ‰è§†é¢‘è®°å½•</p>
                        ) : (
                            <div className="space-y-3">
                                {recentVideos.map(video => (
                                    <div key={video.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                        <div>
                                            <h3 className="font-bold text-gray-800">{video.title}</h3>
                                            <p className="text-sm text-gray-500">{video.publishDate}</p>
                                        </div>
                                        <div className="flex gap-6 text-sm">
                                            <div className="text-center">
                                                <i className="fas fa-eye text-blue-500"></i>
                                                <p className="font-medium">{video.views?.toLocaleString() || 0}</p>
                                            </div>
                                            <div className="text-center">
                                                <i className="fas fa-heart text-red-500"></i>
                                                <p className="font-medium">{video.likes?.toLocaleString() || 0}</p>
                                            </div>
                                            <div className="text-center">
                                                <i className="fas fa-chart-line text-green-500"></i>
                                                <p className="font-medium">{video.completion || 0}%</p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ==================== è®¾ç½®é¡µé¢ ====================
        const SettingsPage = ({ aiProviders, setAiProviders, selectedProvider, setSelectedProvider }) => {
            const [showAddForm, setShowAddForm] = useState(false);
            const [editingProvider, setEditingProvider] = useState(null);

            // é¢„è®¾çš„AIæ¨¡å‹é…ç½®æ¨¡æ¿
            const providerTemplates = {
                doubao: {
                    name: 'è±†åŒ…ï¼ˆå­—èŠ‚è·³åŠ¨ï¼‰',
                    type: 'doubao',
                    icon: 'ğŸ¤–',
                    description: 'å­—èŠ‚è·³åŠ¨çš„è±†åŒ…å¤§æ¨¡å‹ï¼Œæ”¯æŒå›¾åƒç†è§£å’Œæ–‡æœ¬ç”Ÿæˆ',
                    vision: {
                        enabled: true,
                        apiEndpoint: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
                        model: 'doubao-vision-pro-32k',
                        apiKey: ''
                    },
                    text: {
                        enabled: true,
                        apiEndpoint: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
                        model: 'doubao-pro-32k',
                        apiKey: ''
                    }
                },
                openai: {
                    name: 'OpenAI (GPT)',
                    type: 'openai',
                    icon: 'ğŸ”®',
                    description: 'OpenAI çš„ GPT ç³»åˆ—æ¨¡å‹',
                    vision: {
                        enabled: true,
                        apiEndpoint: 'https://api.openai.com/v1/chat/completions',
                        model: 'gpt-4-vision-preview',
                        apiKey: ''
                    },
                    text: {
                        enabled: true,
                        apiEndpoint: 'https://api.openai.com/v1/chat/completions',
                        model: 'gpt-4-turbo-preview',
                        apiKey: ''
                    }
                },
                claude: {
                    name: 'Claude (Anthropic)',
                    type: 'claude',
                    icon: 'ğŸ§ ',
                    description: 'Anthropic çš„ Claude ç³»åˆ—æ¨¡å‹',
                    vision: {
                        enabled: true,
                        apiEndpoint: 'https://api.anthropic.com/v1/messages',
                        model: 'claude-3-opus-20240229',
                        apiKey: ''
                    },
                    text: {
                        enabled: true,
                        apiEndpoint: 'https://api.anthropic.com/v1/messages',
                        model: 'claude-3-sonnet-20240229',
                        apiKey: ''
                    }
                },
                qwen: {
                    name: 'é€šä¹‰åƒé—®ï¼ˆé˜¿é‡Œäº‘ï¼‰',
                    type: 'qwen',
                    icon: 'â˜ï¸',
                    description: 'é˜¿é‡Œäº‘çš„é€šä¹‰åƒé—®å¤§æ¨¡å‹',
                    vision: {
                        enabled: true,
                        apiEndpoint: 'https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation',
                        model: 'qwen-vl-plus',
                        apiKey: ''
                    },
                    text: {
                        enabled: true,
                        apiEndpoint: 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation',
                        model: 'qwen-turbo',
                        apiKey: ''
                    }
                },
                mixed: {
                    name: 'æ··åˆé…ç½®',
                    type: 'mixed',
                    icon: 'ğŸ”€',
                    description: 'è§†è§‰å’Œæ–‡æœ¬ä½¿ç”¨ä¸åŒçš„æ¨¡å‹æœåŠ¡',
                    vision: {
                        enabled: true,
                        apiEndpoint: '',
                        model: '',
                        apiKey: ''
                    },
                    text: {
                        enabled: true,
                        apiEndpoint: '',
                        model: '',
                        apiKey: ''
                    }
                },
                custom: {
                    name: 'è‡ªå®šä¹‰æ¨¡å‹',
                    type: 'custom',
                    icon: 'âš™ï¸',
                    description: 'é…ç½®è‡ªå®šä¹‰çš„ AI æ¨¡å‹',
                    vision: {
                        enabled: false,
                        apiEndpoint: '',
                        model: '',
                        apiKey: ''
                    },
                    text: {
                        enabled: true,
                        apiEndpoint: '',
                        model: '',
                        apiKey: ''
                    }
                }
            };

            const handleAddProvider = (template) => {
                const newProvider = {
                    id: Date.now(),
                    ...providerTemplates[template],
                    apiKey: '',
                    enabled: true,
                    createdAt: new Date().toISOString()
                };
                setEditingProvider(newProvider);
                setShowAddForm(true);
            };

            const handleSaveProvider = (provider) => {
                if (provider.id && aiProviders.find(p => p.id === provider.id)) {
                    // æ›´æ–°ç°æœ‰é…ç½®
                    setAiProviders(aiProviders.map(p => p.id === provider.id ? provider : p));
                } else {
                    // æ·»åŠ æ–°é…ç½®
                    setAiProviders([...aiProviders, provider]);
                    // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªï¼Œè‡ªåŠ¨è®¾ä¸ºé»˜è®¤
                    if (aiProviders.length === 0) {
                        setSelectedProvider(provider.id);
                    }
                }
                setShowAddForm(false);
                setEditingProvider(null);
            };

            const handleDeleteProvider = (id) => {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡å‹é…ç½®å—ï¼Ÿ')) {
                    setAiProviders(aiProviders.filter(p => p.id !== id));
                    if (selectedProvider === id) {
                        setSelectedProvider(aiProviders.find(p => p.id !== id)?.id || null);
                    }
                }
            };

            const handleTestProvider = async (provider) => {
                // é€‰æ‹©æµ‹è¯•æ–‡æœ¬æ¨¡å‹è¿˜æ˜¯è§†è§‰æ¨¡å‹
                const testType = provider.text.enabled ? 'text' : (provider.vision.enabled ? 'vision' : null);
                
                if (!testType) {
                    alert('è¯¥æ¨¡å‹é…ç½®æ²¡æœ‰å¯ç”¨ä»»ä½•åŠŸèƒ½');
                    return;
                }

                const config = testType === 'text' ? provider.text : provider.vision;
                
                if (!config.apiKey) {
                    alert(`è¯·å…ˆé…ç½® ${testType === 'text' ? 'æ–‡æœ¬' : 'è§†è§‰'}æ¨¡å‹çš„ API å¯†é’¥`);
                    return;
                }

                try {
                    let testRequest;
                    
                    if (provider.type === 'doubao') {
                        testRequest = {
                            url: config.apiEndpoint,
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${config.apiKey}`
                            },
                            body: {
                                model: config.model,
                                messages: [{ role: "user", content: "æµ‹è¯•" }]
                            }
                        };
                    } else if (provider.type === 'claude') {
                        testRequest = {
                            url: config.apiEndpoint,
                            headers: {
                                "Content-Type": "application/json",
                                "x-api-key": config.apiKey,
                                "anthropic-version": "2023-06-01"
                            },
                            body: {
                                model: config.model,
                                max_tokens: 100,
                                messages: [{ role: "user", content: "æµ‹è¯•" }]
                            }
                        };
                    } else {
                        // é€šç”¨æµ‹è¯•
                        testRequest = {
                            url: config.apiEndpoint,
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${config.apiKey}`
                            },
                            body: {
                                model: config.model,
                                messages: [{ role: "user", content: "æµ‹è¯•" }]
                            }
                        };
                    }

                    const response = await fetch(testRequest.url, {
                        method: "POST",
                        headers: testRequest.headers,
                        body: JSON.stringify(testRequest.body)
                    });

                    const data = await response.json();
                    
                    if (response.ok) {
                        alert(`âœ… ${testType === 'text' ? 'æ–‡æœ¬' : 'è§†è§‰'}æ¨¡å‹æµ‹è¯•æˆåŠŸï¼è¿æ¥æ­£å¸¸ã€‚`);
                    } else {
                        alert('âŒ æµ‹è¯•å¤±è´¥ï¼š' + (data.error?.message || data.message || 'æœªçŸ¥é”™è¯¯'));
                    }
                } catch (error) {
                    alert('âŒ æµ‹è¯•å¤±è´¥ï¼š' + error.message);
                }
            };

            return (
                <div className="space-y-6">
                    {/* é¡µé¢æ ‡é¢˜ */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <h1 className="text-3xl font-bold text-gray-800 mb-2">
                            <i className="fas fa-cog text-indigo-600 mr-3"></i>
                            ç³»ç»Ÿè®¾ç½®
                        </h1>
                        <p className="text-gray-600">é…ç½® AI æ¨¡å‹å’Œå¯†é’¥ï¼Œæ”¯æŒå¤šä¸ªæ¨¡å‹çµæ´»åˆ‡æ¢</p>
                    </div>

                    {/* å½“å‰ä½¿ç”¨çš„æ¨¡å‹ */}
                    {aiProviders.length > 0 && (
                        <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-indigo-100 text-sm mb-1">å½“å‰ä½¿ç”¨çš„ AI æ¨¡å‹</p>
                                    <h2 className="text-2xl font-bold">
                                        {aiProviders.find(p => p.id === selectedProvider)?.icon || 'ğŸ¤–'} 
                                        {' '}
                                        {aiProviders.find(p => p.id === selectedProvider)?.name || 'æœªé€‰æ‹©'}
                                    </h2>
                                </div>
                                <i className="fas fa-check-circle text-5xl text-white opacity-30"></i>
                            </div>
                        </div>
                    )}

                    {/* å·²é…ç½®çš„æ¨¡å‹åˆ—è¡¨ */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-xl font-bold text-gray-800">
                                <i className="fas fa-server text-blue-600 mr-2"></i>
                                å·²é…ç½®çš„æ¨¡å‹ ({aiProviders.length})
                            </h2>
                            <button
                                onClick={() => setShowAddForm(true)}
                                className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
                            >
                                <i className="fas fa-plus mr-2"></i>
                                æ·»åŠ æ¨¡å‹
                            </button>
                        </div>

                        {aiProviders.length === 0 ? (
                            <div className="text-center py-12">
                                <i className="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 mb-4">è¿˜æ²¡æœ‰é…ç½®ä»»ä½• AI æ¨¡å‹</p>
                                <button
                                    onClick={() => setShowAddForm(true)}
                                    className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                >
                                    <i className="fas fa-plus mr-2"></i>
                                    æ·»åŠ ç¬¬ä¸€ä¸ªæ¨¡å‹
                                </button>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 gap-4">
                                {aiProviders.map(provider => (
                                    <div 
                                        key={provider.id}
                                        className={`border-2 rounded-xl p-5 transition-all ${
                                            selectedProvider === provider.id
                                                ? 'border-indigo-500 bg-indigo-50'
                                                : 'border-gray-200 hover:border-gray-300'
                                        }`}
                                    >
                                        <div className="flex items-start justify-between">
                                            <div className="flex items-start gap-4 flex-1">
                                                <div className="text-4xl">{provider.icon}</div>
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-3 mb-2">
                                                        <h3 className="text-lg font-bold text-gray-800">
                                                            {provider.name}
                                                        </h3>
                                                        {selectedProvider === provider.id && (
                                                            <span className="px-2 py-1 bg-indigo-600 text-white text-xs rounded-full">
                                                                ä½¿ç”¨ä¸­
                                                            </span>
                                                        )}
                                                    </div>
                                                    <p className="text-sm text-gray-600 mb-3">{provider.description}</p>
                                                    <div className="space-y-2 text-xs">
                                                        {provider.vision.enabled && (
                                                            <div className="flex items-start gap-2 p-2 bg-purple-50 rounded">
                                                                <i className="fas fa-image text-purple-600 mt-0.5"></i>
                                                                <div className="flex-1">
                                                                    <div className="font-medium text-gray-700">è§†è§‰æ¨¡å‹</div>
                                                                    <div className="text-gray-600">{provider.vision.model || 'æœªé…ç½®'}</div>
                                                                    <div className="text-gray-500 text-xs">
                                                                        {provider.vision.apiKey ? 'âœ“ å·²é…ç½®å¯†é’¥' : 'âœ— æœªé…ç½®å¯†é’¥'}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                        {provider.text.enabled && (
                                                            <div className="flex items-start gap-2 p-2 bg-green-50 rounded">
                                                                <i className="fas fa-align-left text-green-600 mt-0.5"></i>
                                                                <div className="flex-1">
                                                                    <div className="font-medium text-gray-700">æ–‡æœ¬æ¨¡å‹</div>
                                                                    <div className="text-gray-600">{provider.text.model || 'æœªé…ç½®'}</div>
                                                                    <div className="text-gray-500 text-xs">
                                                                        {provider.text.apiKey ? 'âœ“ å·²é…ç½®å¯†é’¥' : 'âœ— æœªé…ç½®å¯†é’¥'}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="flex gap-2 ml-4">
                                                {selectedProvider !== provider.id && (
                                                    <button
                                                        onClick={() => setSelectedProvider(provider.id)}
                                                        className="px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm"
                                                        title="è®¾ä¸ºé»˜è®¤"
                                                    >
                                                        <i className="fas fa-check"></i>
                                                    </button>
                                                )}
                                                <button
                                                    onClick={() => handleTestProvider(provider)}
                                                    className="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
                                                    title="æµ‹è¯•è¿æ¥"
                                                >
                                                    <i className="fas fa-vial"></i>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setEditingProvider(provider);
                                                        setShowAddForm(true);
                                                    }}
                                                    className="px-3 py-1 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 text-sm"
                                                    title="ç¼–è¾‘"
                                                >
                                                    <i className="fas fa-edit"></i>
                                                </button>
                                                <button
                                                    onClick={() => handleDeleteProvider(provider.id)}
                                                    className="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm"
                                                    title="åˆ é™¤"
                                                >
                                                    <i className="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* æ·»åŠ /ç¼–è¾‘æ¨¡å‹è¡¨å• */}
                    {showAddForm && (
                        <ProviderConfigForm
                            provider={editingProvider}
                            templates={providerTemplates}
                            onSave={handleSaveProvider}
                            onClose={() => {
                                setShowAddForm(false);
                                setEditingProvider(null);
                            }}
                        />
                    )}

                    {/* ä½¿ç”¨è¯´æ˜ */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">
                            <i className="fas fa-question-circle text-orange-600 mr-2"></i>
                            ä½¿ç”¨è¯´æ˜
                        </h2>
                        <div className="space-y-3 text-sm text-gray-700">
                            <div className="flex items-start gap-3">
                                <i className="fas fa-circle text-xs text-indigo-600 mt-1"></i>
                                <p><strong>æ·»åŠ æ¨¡å‹ï¼š</strong>ç‚¹å‡»"æ·»åŠ æ¨¡å‹"æŒ‰é’®ï¼Œé€‰æ‹©é¢„è®¾æ¨¡æ¿æˆ–è‡ªå®šä¹‰é…ç½®</p>
                            </div>
                            <div className="flex items-start gap-3">
                                <i className="fas fa-circle text-xs text-green-600 mt-1"></i>
                                <p><strong>è®¾ä¸ºé»˜è®¤ï¼š</strong>ç‚¹å‡»æ¨¡å‹å¡ç‰‡ä¸Šçš„ âœ“ æŒ‰é’®ï¼Œå°†è¯¥æ¨¡å‹è®¾ä¸ºé»˜è®¤ä½¿ç”¨</p>
                            </div>
                            <div className="flex items-start gap-3">
                                <i className="fas fa-circle text-xs text-blue-600 mt-1"></i>
                                <p><strong>æµ‹è¯•è¿æ¥ï¼š</strong>é…ç½®å®Œæˆåï¼Œå»ºè®®ä½¿ç”¨"æµ‹è¯•"æŒ‰é’®éªŒè¯ API æ˜¯å¦æ­£å¸¸</p>
                            </div>
                            <div className="flex items-start gap-3">
                                <i className="fas fa-circle text-xs text-purple-600 mt-1"></i>
                                <p><strong>çµæ´»åˆ‡æ¢ï¼š</strong>å¯ä»¥é…ç½®å¤šä¸ªæ¨¡å‹ï¼Œéšæ—¶åˆ‡æ¢ä½¿ç”¨ä¸åŒçš„ AI æœåŠ¡</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== æ¨¡å‹é…ç½®è¡¨å• ====================
        const ProviderConfigForm = ({ provider, templates, onSave, onClose }) => {
            const [formData, setFormData] = useState(provider || {
                id: null,
                name: '',
                type: '',
                icon: 'ğŸ¤–',
                description: '',
                vision: {
                    enabled: false,
                    apiEndpoint: '',
                    model: '',
                    apiKey: ''
                },
                text: {
                    enabled: true,
                    apiEndpoint: '',
                    model: '',
                    apiKey: ''
                }
            });
            const [showVisionKey, setShowVisionKey] = useState(false);
            const [showTextKey, setShowTextKey] = useState(false);
            const [selectedTemplate, setSelectedTemplate] = useState(provider?.type || '');

            const handleTemplateSelect = (templateKey) => {
                setSelectedTemplate(templateKey);
                const template = templates[templateKey];
                setFormData({
                    ...formData,
                    ...template,
                    // ä¿ç•™å·²è¾“å…¥çš„å¯†é’¥
                    vision: {
                        ...template.vision,
                        apiKey: formData.vision.apiKey
                    },
                    text: {
                        ...template.text,
                        apiKey: formData.text.apiKey
                    }
                });
            };

            const handleSubmit = () => {
                if (!formData.name) {
                    alert('è¯·å¡«å†™æ¨¡å‹åç§°');
                    return;
                }
                
                if (formData.vision.enabled && (!formData.vision.apiEndpoint || !formData.vision.model)) {
                    alert('è¯·å®Œæ•´é…ç½®è§†è§‰æ¨¡å‹ä¿¡æ¯');
                    return;
                }
                
                if (formData.text.enabled && (!formData.text.apiEndpoint || !formData.text.model)) {
                    alert('è¯·å®Œæ•´é…ç½®æ–‡æœ¬æ¨¡å‹ä¿¡æ¯');
                    return;
                }
                
                const savedData = {
                    ...formData,
                    id: formData.id || Date.now(),
                    createdAt: formData.createdAt || new Date().toISOString()
                };
                
                onSave(savedData);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div className="p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">
                                    <i className="fas fa-plus-circle text-indigo-600 mr-2"></i>
                                    {provider?.id ? 'ç¼–è¾‘æ¨¡å‹é…ç½®' : 'æ·»åŠ  AI æ¨¡å‹'}
                                </h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-600 text-2xl">
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>

                            {/* æ¨¡æ¿é€‰æ‹© */}
                            {!provider?.id && (
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-3">
                                        é€‰æ‹©æ¨¡å‹æ¨¡æ¿
                                    </label>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        {Object.entries(templates).map(([key, template]) => (
                                            <button
                                                key={key}
                                                onClick={() => handleTemplateSelect(key)}
                                                className={`p-4 border-2 rounded-lg text-left transition-all ${
                                                    selectedTemplate === key
                                                        ? 'border-indigo-500 bg-indigo-50'
                                                        : 'border-gray-200 hover:border-gray-300'
                                                }`}
                                            >
                                                <div className="text-3xl mb-2">{template.icon}</div>
                                                <div className="font-medium text-gray-800 text-sm">{template.name}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* åŸºæœ¬ä¿¡æ¯ */}
                            <div className="space-y-4 mb-6">
                                <h3 className="font-bold text-gray-800 border-b pb-2">åŸºæœ¬ä¿¡æ¯</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            æ¨¡å‹åç§° *
                                        </label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                            placeholder="ä¾‹å¦‚ï¼šè±†åŒ…å¤§æ¨¡å‹"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            å›¾æ ‡
                                        </label>
                                        <input
                                            type="text"
                                            value={formData.icon}
                                            onChange={(e) => setFormData({ ...formData, icon: e.target.value })}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                            placeholder="ğŸ¤–"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        æè¿°
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.description}
                                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        placeholder="ç®€å•æè¿°è¿™ä¸ªæ¨¡å‹"
                                    />
                                </div>
                            </div>

                            {/* è§†è§‰æ¨¡å‹é…ç½® */}
                            <div className="space-y-4 mb-6 p-4 bg-purple-50 rounded-lg">
                                <div className="flex items-center justify-between">
                                    <h3 className="font-bold text-gray-800">
                                        <i className="fas fa-image text-purple-600 mr-2"></i>
                                        è§†è§‰æ¨¡å‹é…ç½®ï¼ˆç”¨äºç´ æåˆ†æï¼‰
                                    </h3>
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={formData.vision.enabled}
                                            onChange={(e) => setFormData({
                                                ...formData,
                                                vision: { ...formData.vision, enabled: e.target.checked }
                                            })}
                                            className="w-4 h-4"
                                        />
                                        <span className="text-sm text-gray-700">å¯ç”¨</span>
                                    </label>
                                </div>

                                {formData.vision.enabled && (
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                API ç«¯ç‚¹ *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.vision.apiEndpoint}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    vision: { ...formData.vision, apiEndpoint: e.target.value }
                                                })}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="https://api.example.com/v1/chat/completions"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                æ¨¡å‹ ID *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.vision.model}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    vision: { ...formData.vision, model: e.target.value }
                                                })}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="gpt-4-vision-preview"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                API å¯†é’¥ *
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type={showVisionKey ? "text" : "password"}
                                                    value={formData.vision.apiKey}
                                                    onChange={(e) => setFormData({
                                                        ...formData,
                                                        vision: { ...formData.vision, apiKey: e.target.value }
                                                    })}
                                                    className="w-full px-3 py-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="sk-xxxxxx"
                                                />
                                                <button
                                                    onClick={() => setShowVisionKey(!showVisionKey)}
                                                    className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                                >
                                                    <i className={`fas ${showVisionKey ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* æ–‡æœ¬æ¨¡å‹é…ç½® */}
                            <div className="space-y-4 mb-6 p-4 bg-green-50 rounded-lg">
                                <div className="flex items-center justify-between">
                                    <h3 className="font-bold text-gray-800">
                                        <i className="fas fa-align-left text-green-600 mr-2"></i>
                                        æ–‡æœ¬æ¨¡å‹é…ç½®ï¼ˆç”¨äºæ™ºèƒ½æ£€ç´¢ï¼‰
                                    </h3>
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            checked={formData.text.enabled}
                                            onChange={(e) => setFormData({
                                                ...formData,
                                                text: { ...formData.text, enabled: e.target.checked }
                                            })}
                                            className="w-4 h-4"
                                        />
                                        <span className="text-sm text-gray-700">å¯ç”¨</span>
                                    </label>
                                </div>

                                {formData.text.enabled && (
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                API ç«¯ç‚¹ *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.text.apiEndpoint}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    text: { ...formData.text, apiEndpoint: e.target.value }
                                                })}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="https://api.example.com/v1/chat/completions"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                æ¨¡å‹ ID *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.text.model}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    text: { ...formData.text, model: e.target.value }
                                                })}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="gpt-4-turbo"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                API å¯†é’¥ *
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type={showTextKey ? "text" : "password"}
                                                    value={formData.text.apiKey}
                                                    onChange={(e) => setFormData({
                                                        ...formData,
                                                        text: { ...formData.text, apiKey: e.target.value }
                                                    })}
                                                    className="w-full px-3 py-2 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="sk-xxxxxx"
                                                />
                                                <button
                                                    onClick={() => setShowTextKey(!showTextKey)}
                                                    className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                                >
                                                    <i className={`fas ${showTextKey ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <p className="text-xs text-blue-800">
                                    <i className="fas fa-info-circle mr-1"></i>
                                    <strong>æç¤ºï¼š</strong>å¦‚æœè§†è§‰å’Œæ–‡æœ¬ä½¿ç”¨ç›¸åŒçš„æœåŠ¡å’Œå¯†é’¥ï¼Œå¯ä»¥å¡«å†™ç›¸åŒçš„é…ç½®ï¼›å¦‚æœä½¿ç”¨ä¸åŒæœåŠ¡ï¼Œè¯·åˆ†åˆ«é…ç½®ã€‚
                                </p>
                            </div>

                            {/* æ“ä½œæŒ‰é’® */}
                            <div className="flex gap-3 justify-end mt-6">
                                <button
                                    onClick={onClose}
                                    className="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                >
                                    å–æ¶ˆ
                                </button>
                                <button
                                    onClick={handleSubmit}
                                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                >
                                    <i className="fas fa-save mr-2"></i>
                                    ä¿å­˜é…ç½®
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== ç»Ÿè®¡å¡ç‰‡ç»„ä»¶ ====================
        const StatCard = ({ icon, title, value, color }) => {
            const colors = {
                blue: 'from-blue-500 to-blue-600',
                red: 'from-red-500 to-red-600',
                green: 'from-green-500 to-green-600',
                yellow: 'from-yellow-500 to-yellow-600',
                purple: 'from-purple-500 to-purple-600',
                orange: 'from-orange-500 to-orange-600'
            };

            return (
                <div className={`bg-gradient-to-br ${colors[color]} rounded-xl shadow-lg p-6 text-white`}>
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-white text-opacity-90 text-sm mb-1">{title}</p>
                            <p className="text-3xl font-bold">{value}</p>
                        </div>
                        <i className={`fas ${icon} text-4xl text-white text-opacity-30`}></i>
                    </div>
                </div>
            );
        };

        // ==================== åº•éƒ¨ä¿¡æ¯ ====================
        const Footer = ({ materials, topics, videos }) => {
            const exportData = async () => {
                const data = {
                    materials,
                    topics,
                    videos,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `content-system-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼')) {
                                await window.storage.set('materials_v2', JSON.stringify(data.materials || []), false);
                                await window.storage.set('topics_v2', JSON.stringify(data.topics || []), false);
                                await window.storage.set('videos_v2', JSON.stringify(data.videos || []), false);
                                window.location.reload();
                            }
                        } catch (error) {
                            alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            return (
                <footer className="bg-white border-t mt-12 py-6">
                    <div className="container mx-auto px-4">
                        <div className="flex flex-col md:flex-row items-center justify-between gap-4">
                            <div className="text-gray-600 text-sm">
                                <p>
                                    <i className="fas fa-database mr-2"></i>
                                    æ•°æ®ç»Ÿè®¡ï¼š{materials.length} ä¸ªç´ æ Â· {topics.length} ä¸ªé€‰é¢˜ Â· {videos.length} ä¸ªè§†é¢‘
                                </p>
                            </div>
                            <div className="flex gap-3">
                                <button
                                    onClick={exportData}
                                    className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm"
                                >
                                    <i className="fas fa-download mr-2"></i>å¯¼å‡ºæ•°æ®
                                </button>
                                <label className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer text-sm">
                                    <i className="fas fa-upload mr-2"></i>å¯¼å…¥æ•°æ®
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={importData}
                                        className="hidden"
                                    />
                                </label>
                            </div>
                        </div>
                    </div>
                </footer>
            );
        };

        // ==================== æ¸²æŸ“åº”ç”¨ ====================
        ReactDOM.render(<ContentProductionApp />, document.getElementById('root'));
    </script>
</body>
</html>
