# ğŸš€ ç»ˆæéƒ¨ç½²æŒ‡å— - 3å°æ—¶ä¸Šçº¿

## â±ï¸ æ—¶é—´çº¿

- **ç¬¬1å°æ—¶**: æœ¬åœ°æµ‹è¯• âœ…
- **ç¬¬2å°æ—¶**: è´­ä¹°é˜¿é‡Œäº‘æœåŠ¡å¹¶é…ç½® âœ…
- **ç¬¬3å°æ—¶**: éƒ¨ç½²ä¸Šçº¿ âœ…

---

## ğŸ¯ ç¬¬1å°æ—¶ï¼šæœ¬åœ°æµ‹è¯•

### Step 1: è§£å‹é¡¹ç›® (2åˆ†é’Ÿ)
```bash
tar -xzf video-production-COMPLETE.tar.gz
cd video-production-system
```

### Step 2: åˆå§‹åŒ–æ•°æ®åº“ (5åˆ†é’Ÿ)
```bash
# å¯åŠ¨MySQL
mysql -u root -p

# å¯¼å…¥æ•°æ®åº“
source database/schema.sql

# éªŒè¯
USE video_production_db;
SHOW TABLES;
# åº”è¯¥çœ‹åˆ°6å¼ è¡¨
```

### Step 3: é…ç½®åç«¯ (10åˆ†é’Ÿ)
```bash
cd backend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env

# ç¼–è¾‘ .env
vim .env
```

**å¡«å†™ä»¥ä¸‹å†…å®¹ï¼š**
```env
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=video_production_db

JWT_SECRET=your-super-secret-key-change-this
JWT_EXPIRES_IN=7d

# OSS å…ˆç•™ç©ºï¼Œæœ¬åœ°æµ‹è¯•ä¸éœ€è¦
OSS_REGION=
OSS_ACCESS_KEY_ID=
OSS_ACCESS_KEY_SECRET=
OSS_BUCKET=
```

### Step 4: å¯åŠ¨åç«¯ (5åˆ†é’Ÿ)
```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨
npm run start:dev

# çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯è¡¨ç¤ºæˆåŠŸï¼š
# ğŸš€ Server is running on: http://localhost:3000/api
```

### Step 5: æµ‹è¯•API (10åˆ†é’Ÿ)
```bash
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯
cd video-production-system

# è¿è¡Œæµ‹è¯•è„šæœ¬
chmod +x TEST_API.sh
./TEST_API.sh

# æˆ–è€…æ‰‹åŠ¨æµ‹è¯•
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@test.com","password":"123456"}'
```

**âœ… ç¬¬1å°æ—¶å®Œæˆï¼åç«¯APIå…¨éƒ¨æ­£å¸¸è¿è¡Œï¼**

---

## ğŸ’° ç¬¬2å°æ—¶ï¼šè´­ä¹°é˜¿é‡Œäº‘æœåŠ¡

### Step 1: è´­ä¹°ECSæœåŠ¡å™¨ (10åˆ†é’Ÿ)

1. è®¿é—®ï¼šhttps://ecs.console.aliyun.com
2. ç‚¹å‡»"åˆ›å»ºå®ä¾‹"
3. é…ç½®é€‰æ‹©ï¼š
   - **åœ°åŸŸ**: åä¸œ1ï¼ˆæ­å·ï¼‰
   - **å®ä¾‹è§„æ ¼**: 2æ ¸4Gï¼ˆå…¥é—¨ï¼‰æˆ– 4æ ¸8Gï¼ˆæ¨èï¼‰
   - **é•œåƒ**: Ubuntu 20.04 LTS
   - **å¸¦å®½**: 5Mbps
   - **å­˜å‚¨**: 40GB ç³»ç»Ÿç›˜
   - **å®‰å…¨ç»„**: å¼€æ”¾ 22, 80, 443 ç«¯å£

4. **ä»·æ ¼**: çº¦ Â¥200-400/æœˆ

### Step 2: è´­ä¹°RDS MySQL (10åˆ†é’Ÿ)

1. è®¿é—®ï¼šhttps://rdsnext.console.aliyun.com
2. ç‚¹å‡»"åˆ›å»ºå®ä¾‹"
3. é…ç½®é€‰æ‹©ï¼š
   - **åœ°åŸŸ**: åä¸œ1ï¼ˆæ­å·ï¼‰- ä¸ECSåŒåœ°åŸŸ
   - **ç‰ˆæœ¬**: MySQL 8.0
   - **è§„æ ¼**: 2æ ¸4G èµ·æ­¥
   - **å­˜å‚¨**: 20GB SSD
   - **ç½‘ç»œ**: ä¸“æœ‰ç½‘ç»œï¼ˆVPCï¼‰

4. **ç™½åå•è®¾ç½®**:
   - æ·»åŠ  ECS å†…ç½‘IP
   - å…è®¸è¿œç¨‹è¿æ¥

5. **ä»·æ ¼**: çº¦ Â¥200-300/æœˆ

### Step 3: è´­ä¹°OSSå¯¹è±¡å­˜å‚¨ (5åˆ†é’Ÿ)

1. è®¿é—®ï¼šhttps://oss.console.aliyun.com
2. åˆ›å»ºBucketï¼š
   - **Bucketåç§°**: video-materials-yourname
   - **åœ°åŸŸ**: åä¸œ1ï¼ˆæ­å·ï¼‰
   - **è¯»å†™æƒé™**: å…¬å…±è¯»
   - **å­˜å‚¨ç±»å‹**: æ ‡å‡†å­˜å‚¨

3. è·å–AccessKeyï¼š
   - è®¿é—®ï¼šhttps://ram.console.aliyun.com/manage/ak
   - åˆ›å»ºAccessKey
   - **ä¿å­˜å¥½ AccessKeyId å’Œ AccessKeySecret**

4. **ä»·æ ¼**: æŒ‰é‡ä»˜è´¹ï¼Œçº¦ Â¥0.12/GB/æœˆ

### Step 4: é…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰(15åˆ†é’Ÿ)

1. è´­ä¹°åŸŸåï¼ˆå¦‚å·²æœ‰å¯è·³è¿‡ï¼‰
2. å®ŒæˆICPå¤‡æ¡ˆ
3. é…ç½®DNSè§£æï¼š
   - Aè®°å½•: `@` â†’ ECSå…¬ç½‘IP
   - Aè®°å½•: `api` â†’ ECSå…¬ç½‘IP

**âœ… ç¬¬2å°æ—¶å®Œæˆï¼æ‰€æœ‰é˜¿é‡Œäº‘æœåŠ¡å·²å°±ç»ªï¼**

---

## ğŸŒ ç¬¬3å°æ—¶ï¼šéƒ¨ç½²ä¸Šçº¿

### Step 1: è¿æ¥åˆ°ECS (2åˆ†é’Ÿ)
```bash
ssh root@your-ecs-ip
```

### Step 2: å®‰è£…ç¯å¢ƒ (20åˆ†é’Ÿ)
```bash
# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs

# å®‰è£… Nginx
apt install -y nginx

# å®‰è£… PM2
npm install -g pm2

# éªŒè¯
node -v  # v18.x.x
npm -v   # 9.x.x
nginx -v # nginx/1.18.0
pm2 -v   # 5.x.x
```

### Step 3: å¯¼å…¥æ•°æ®åº“åˆ°RDS (5åˆ†é’Ÿ)
```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
mysql -h rm-xxxxx.mysql.rds.aliyuncs.com -u username -p \
  video_production_db < database/schema.sql
```

### Step 4: éƒ¨ç½²åç«¯ (15åˆ†é’Ÿ)
```bash
# åˆ›å»ºç›®å½•
mkdir -p /var/www/video-production
cd /var/www/video-production

# ä¸Šä¼ ä»£ç ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
scp -r backend root@your-ecs-ip:/var/www/video-production/

# åœ¨æœåŠ¡å™¨ä¸Š
cd /var/www/video-production/backend

# å®‰è£…ä¾èµ–
npm install --production

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env
```

**å¡«å†™ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š**
```env
NODE_ENV=production
PORT=3000

# RDSæ•°æ®åº“
DB_HOST=rm-xxxxx.mysql.rds.aliyuncs.com
DB_PORT=3306
DB_USERNAME=your_username
DB_PASSWORD=your_password
DB_DATABASE=video_production_db

# JWT
JWT_SECRET=your-production-secret-very-long-and-random
JWT_EXPIRES_IN=7d

# OSS
OSS_REGION=oss-cn-hangzhou
OSS_ACCESS_KEY_ID=LTAI5xxxxx
OSS_ACCESS_KEY_SECRET=xxxxx
OSS_BUCKET=video-materials-yourname
OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com

# CORS
CORS_ORIGIN=https://your-domain.com
```

```bash
# æ„å»º
npm run build

# å¯åŠ¨
pm2 start dist/main.js --name video-api

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs video-api
```

### Step 5: é…ç½®Nginx (10åˆ†é’Ÿ)
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
vim /etc/nginx/sites-available/video-production
```

**ç²˜è´´ä»¥ä¸‹é…ç½®ï¼š**
```nginx
# APIæœåŠ¡å™¨
server {
    listen 80;
    server_name api.your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# å‰ç«¯åº”ç”¨
server {
    listen 80;
    server_name your-domain.com;

    root /var/www/video-production/frontend;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

```bash
# å¯ç”¨é…ç½®
ln -s /etc/nginx/sites-available/video-production /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
nginx -t

# é‡å¯Nginx
systemctl restart nginx
```

### Step 6: é…ç½®HTTPS (8åˆ†é’Ÿ)
```bash
# å®‰è£…Certbot
apt install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
certbot --nginx -d your-domain.com -d api.your-domain.com

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

### Step 7: æµ‹è¯•éªŒè¯ (5åˆ†é’Ÿ)
```bash
# æµ‹è¯•API
curl https://api.your-domain.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@test.com","password":"123456"}'

# åº”è¯¥è¿”å› Token
```

**âœ… ç¬¬3å°æ—¶å®Œæˆï¼é¡¹ç›®å·²æˆåŠŸä¸Šçº¿ï¼**

---

## ğŸ‰ æˆåŠŸæ ‡å¿—

è®¿é—®ä»¥ä¸‹URLéªŒè¯ï¼š

- âœ… `https://api.your-domain.com/api` - è¿”å›404ï¼ˆæ­£å¸¸ï¼Œå› ä¸ºæ ¹è·¯å¾„æ²¡æœ‰å¤„ç†ï¼‰
- âœ… `https://your-domain.com` - å‰ç«¯é¡µé¢åŠ è½½
- âœ… å¯ä»¥æ³¨å†Œå’Œç™»å½•
- âœ… å¯ä»¥åˆ›å»ºç´ æ
- âœ… æ–‡ä»¶å¯ä»¥ä¸Šä¼ åˆ°OSS

---

## ğŸ“Š æˆæœ¬ä¼°ç®—

| æœåŠ¡ | é…ç½® | æœˆè´¹ç”¨ |
|------|------|-------|
| ECSæœåŠ¡å™¨ | 2æ ¸4G | Â¥200-300 |
| RDS MySQL | 2æ ¸4G | Â¥200-300 |
| OSSå­˜å‚¨ | 50GB | Â¥6 |
| å¸¦å®½æµé‡ | 100GB | Â¥80 |
| **æ€»è®¡** | | **Â¥486-686/æœˆ** |

**ä¼˜åŒ–å»ºè®®ï¼š**
- ä½¿ç”¨åŒ…å¹´è´­ä¹°å¯èŠ‚çœ30%
- æµé‡æŒ‰éœ€è®¡è´¹å¯èŠ‚çœ50%
- æ–°ç”¨æˆ·æœ‰ä¼˜æƒ åˆ¸

---

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. è¿æ¥æ•°æ®åº“å¤±è´¥ï¼Ÿ
```bash
# æ£€æŸ¥RDSç™½åå•
# æ£€æŸ¥å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾3306
# æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
```

### 2. PM2å¯åŠ¨å¤±è´¥ï¼Ÿ
```bash
pm2 logs video-api  # æŸ¥çœ‹æ—¥å¿—
pm2 restart video-api  # é‡å¯
```

### 3. Nginx 502é”™è¯¯ï¼Ÿ
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
pm2 status

# æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®
netstat -tlnp | grep 3000
```

### 4. OSSä¸Šä¼ å¤±è´¥ï¼Ÿ
```bash
# æ£€æŸ¥AccessKeyæ˜¯å¦æ­£ç¡®
# æ£€æŸ¥Bucketæƒé™æ˜¯å¦è®¾ç½®ä¸ºå…¬å…±è¯»
# æ£€æŸ¥Bucketåç§°æ˜¯å¦æ­£ç¡®
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
ALTER TABLE materials ADD INDEX idx_user_created (user_id, created_at);
ALTER TABLE topics ADD INDEX idx_status (status);

-- å®šæœŸæ¸…ç†æ—¥å¿—
DELETE FROM operation_logs WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

### CDNåŠ é€Ÿ
- å°†å‰ç«¯é™æ€èµ„æºä¸Šä¼ åˆ°OSS
- å¼€å¯OSS CDNåŠ é€Ÿ
- å›¾ç‰‡æ·»åŠ å¤„ç†å‚æ•°ï¼ˆç¼©ç•¥å›¾ã€å‹ç¼©ï¼‰

### Redisç¼“å­˜
```bash
# å®‰è£…Redis
apt install redis-server

# ä¿®æ”¹åç«¯ä»£ç ï¼Œæ·»åŠ ç¼“å­˜å±‚
# ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆç»Ÿè®¡ã€åˆ—è¡¨ç­‰ï¼‰
```

---

## ğŸ”’ å®‰å…¨åŠ å›º

```bash
# 1. ä¿®æ”¹SSHç«¯å£
vim /etc/ssh/sshd_config
# Port 22 æ”¹ä¸º Port 2222

# 2. ç¦ç”¨rootç™»å½•
# PermitRootLogin yes æ”¹ä¸º PermitRootLogin no

# 3. é…ç½®é˜²ç«å¢™
ufw allow 2222/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw enable

# 4. å®šæœŸæ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# 5. å®šæœŸå¤‡ä»½æ•°æ®åº“
# åœ¨RDSæ§åˆ¶å°é…ç½®è‡ªåŠ¨å¤‡ä»½
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- PM2æ—¥å¿—: `pm2 logs video-api`
- Nginxæ—¥å¿—: `/var/log/nginx/error.log`
- ç³»ç»Ÿæ—¥å¿—: `/var/log/syslog`

---

ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼ğŸŠ
